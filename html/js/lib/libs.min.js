var JSON;JSON||(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var TableKit=Class.create();TableKit.prototype={initialize:function(e,t){var n=$(e);if(n.tagName!=="TABLE")return;TableKit.register(n,Object.extend(TableKit.options,t||{})),this.id=n.id;var r=TableKit.option("sortable resizable editable",this.id);r.sortable&&TableKit.Sortable.init(n),r.resizable&&TableKit.Resizable.init(n),r.editable&&TableKit.Editable.init(n)},sort:function(e,t){TableKit.Sortable.sort(this.id,e,t)},resizeColumn:function(e,t){TableKit.Resizable.resize(this.id,e,t)},editCell:function(e,t){TableKit.Editable.editCell(this.id,e,t)}},Object.extend(TableKit,{getBodyRows:function(e){e=$(e);var t=e.id;return TableKit.tables[t].dom.rows||(TableKit.tables[t].dom.rows=e.tHead&&e.tHead.rows.length>0?$A(e.tBodies[0].rows):$A(e.rows).without(e.rows[0])),TableKit.tables[t].dom.rows},getHeaderCells:function(e,t){e||(e=$(t).up("table"));var n=e.id;return TableKit.tables[n].dom.head||(TableKit.tables[n].dom.head=$A(e.tHead&&e.tHead.rows.length>0?e.tHead.rows[e.tHead.rows.length-1].cells:e.rows[0].cells)),TableKit.tables[n].dom.head},getCellIndex:function(e){return $A(e.parentNode.cells).indexOf(e)},getRowIndex:function(e){return $A(e.parentNode.rows).indexOf(e)},getCellText:function(e,t){if(!e)return"";var n=TableKit.getCellData(e);if(t||n.refresh||!n.textContent)n.textContent=e.textContent?e.textContent:e.innerText,n.refresh=!1;return n.textContent},getCellData:function(e){var t=null;e.id||(t=$(e).up("table"),e.id=t.id+"-cell-"+TableKit._getc());var n=t?t.id:e.id.match(/(.*)-cell.*/)[1];return TableKit.tables[n].dom.cells[e.id]||(TableKit.tables[n].dom.cells[e.id]={textContent:"",htmlContent:"",active:!1}),TableKit.tables[n].dom.cells[e.id]},register:function(e,t){e.id||(e.id="tablekit-table-"+TableKit._getc());var n=e.id;TableKit.tables[n]=TableKit.tables[n]?Object.extend(TableKit.tables[n],t||{}):Object.extend({dom:{head:null,rows:null,cells:{}},sortable:!1,resizable:!1,editable:!1},t||{})},notify:function(e,t,n){TableKit.tables[t.id]&&TableKit.tables[t.id].observers&&TableKit.tables[t.id].observers[e]&&TableKit.tables[t.id].observers[e](t,n),TableKit.options.observers[e](t,n)()},isSortable:function(e){return TableKit.tables[e.id]?TableKit.tables[e.id].sortable:!1},isResizable:function(e){return TableKit.tables[e.id]?TableKit.tables[e.id].resizable:!1},isEditable:function(e){return TableKit.tables[e.id]?TableKit.tables[e.id].editable:!1},setup:function(e){Object.extend(TableKit.options,e||{})},option:function(e,t,n,r){n=n||TableKit.options,r=r||(t?TableKit.tables[t]?TableKit.tables[t]:{}:{});var i=t+e;return TableKit._opcache[i]||(TableKit._opcache[i]=$A($w(e)).inject([],function(e,t){return e.push(e[t]=r[t]||n[t]),e})),TableKit._opcache[i]},e:function(e){return e||window.event},tables:{},_opcache:{},options:{autoLoad:!0,stripe:!0,sortable:!0,resizable:!0,editable:!0,rowEvenClass:"roweven",rowOddClass:"rowodd",sortableSelector:["table.sortable"],columnClass:"sortcol",descendingClass:"sortdesc",ascendingClass:"sortasc",defaultSortDirection:1,noSortClass:"nosort",sortFirstAscendingClass:"sortfirstasc",sortFirstDecendingClass:"sortfirstdesc",resizableSelector:["table.resizable"],minWidth:10,showHandle:!0,resizeOnHandleClass:"resize-handle-active",editableSelector:["table.editable"],formClassName:"editable-cell-form",noEditClass:"noedit",editAjaxURI:"/",editAjaxOptions:{},observers:{onSortStart:function(){},onSort:function(){},onSortEnd:function(){},onResizeStart:function(){},onResize:function(){},onResizeEnd:function(){},onEditStart:function(){},onEdit:function(){},onEditEnd:function(){}}},_c:0,_getc:function(){return TableKit._c+=1},unloadTable:function(e){e=$(e);if(!TableKit.tables[e.id])return;var t=TableKit.getHeaderCells(e),n=TableKit.option("sortable resizable editable noSortClass descendingClass ascendingClass columnClass sortFirstAscendingClass sortFirstDecendingClass",e.id);t.each(function(e){e=$(e),n.sortable&&(e.hasClassName(n.noSortClass)||(Event.stopObserving(e,"mousedown",TableKit.Sortable._sort),e.removeClassName(n.columnClass),e.removeClassName(n.sortFirstAscendingClass),e.removeClassName(n.sortFirstDecendingClass),e.hasClassName(n.ascendingClass)?(e.removeClassName(n.ascendingClass),e.addClassName(n.sortFirstAscendingClass)):e.hasClassName(n.descendingClass)&&(e.removeClassName(n.descendingClass),e.addClassName(n.sortFirstDecendingClass)))),n.resizable&&(Event.stopObserving(e,"mouseover",TableKit.Resizable.initDetect),Event.stopObserving(e,"mouseout",TableKit.Resizable.killDetect))});if(n.editable){Event.stopObserving(e.tBodies[0],"click",TableKit.Editable._editCell);for(var r in TableKit.tables[e.id].dom.cells)if(TableKit.tables[e.id].dom.cells[r].active){var i=$(r),s=TableKit.Editable.getCellEditor(i);s.cancel(i)}}TableKit.tables[e.id].dom={head:null,rows:null,cells:{}}},reloadTable:function(e){e=$(e),TableKit.unloadTable(e);var t=TableKit.option("sortable resizable editable",e.id);t.sortable&&TableKit.Sortable.init(e),t.resizable&&TableKit.Resizable.init(e),t.editable&&TableKit.Editable.init(e)},reload:function(){for(var e in TableKit.tables)TableKit.reloadTable(e)},load:function(){TableKit.options.autoLoad&&(TableKit.options.sortable&&$A(TableKit.options.sortableSelector).each(function(e){$$(e).each(function(e){TableKit.Sortable.init(e)})}),TableKit.options.resizable&&$A(TableKit.options.resizableSelector).each(function(e){$$(e).each(function(e){TableKit.Resizable.init(e)})}),TableKit.options.editable&&$A(TableKit.options.editableSelector).each(function(e){$$(e).each(function(e){TableKit.Editable.init(e)})}))}}),TableKit.Rows={stripe:function(e){var t=TableKit.getBodyRows(e);t.each(function(t,n){TableKit.Rows.addStripeClass(e,t,n)})},addStripeClass:function(e,t,n){e=e||t.up("table");var r=TableKit.option("rowEvenClass rowOddClass",e.id),i=(n+1)%2===0?r[0]:r[1],s=t.className.split(/\s+/),o=[];for(var u=0,a=s.length;u<a;u+=1)s[u]!==r[0]&&s[u]!==r[1]&&o.push(s[u]);o.push(i),t.className=o.join(" ")}},TableKit.Sortable={init:function(e,t){var n=$(e);if(n.tagName!=="TABLE")return;TableKit.register(n,Object.extend(t||{},{sortable:!0}));var r,i=TableKit.getHeaderCells(n),s=TableKit.option("noSortClass columnClass sortFirstAscendingClass sortFirstDecendingClass",n.id);i.each(function(e){e=$(e);if(!e.hasClassName(s.noSortClass)){Event.observe(e,"mousedown",TableKit.Sortable._sort),e.addClassName(s.columnClass);if(e.hasClassName(s.sortFirstAscendingClass)||e.hasClassName(s.sortFirstDecendingClass))r=e}}),r?r.hasClassName(s.sortFirstAscendingClass)?TableKit.Sortable.sort(n,r,1):TableKit.Sortable.sort(n,r,-1):TableKit.Rows.stripe(n)},reload:function(e){e=$(e);var t=TableKit.getHeaderCells(e),n=TableKit.option("noSortClass columnClass",e.id);t.each(function(e){e=$(e),e.hasClassName(n.noSortClass)||(Event.stopObserving(e,"mousedown",TableKit.Sortable._sort),e.removeClassName(n.columnClass))}),TableKit.Sortable.init(e)},_sort:function(e){if(TableKit.Resizable._onHandle)return;e=TableKit.e(e),Event.stop(e);var t=Event.element(e);while(!t.tagName||!t.tagName.match(/td|th/gi))t=t.parentNode;TableKit.Sortable.sort(null,t)},sort:function(e,t,n){var r;if(typeof t=="number"){if(!e||e.tagName&&e.tagName!=="TABLE")return;e=$(e),t=Math.min(e.rows[0].cells.length,t),t=Math.max(1,t),t-=1,r=e.tHead&&e.tHead.rows.length>0?$(e.tHead.rows[e.tHead.rows.length-1].cells[t]):$(e.rows[0].cells[t])}else r=$(t),e=e?$(e):r.up("table"),t=TableKit.getCellIndex(r);var i=TableKit.option("noSortClass descendingClass ascendingClass defaultSortDirection",e.id);if(r.hasClassName(i.noSortClass))return;n=n?n:i.defaultSortDirection;var s=TableKit.getBodyRows(e);if(r.hasClassName(i.ascendingClass)||r.hasClassName(i.descendingClass))s.reverse(),n=r.hasClassName(i.descendingClass)?1:-1;else{var o=TableKit.Sortable.getDataType(r,t,e),u=TableKit.Sortable.types;s.sort(function(e,r){return n*u[o].compare(TableKit.getCellText(e.cells[t]),TableKit.getCellText(r.cells[t]))})}var a=e.tBodies[0],f=TableKit.Rows;s.each(function(t,n){a.appendChild(t),f.addStripeClass(e,t,n)});var l=TableKit.getHeaderCells(null,r);$A(l).each(function(e,r){e=$(e),e.removeClassName(i.ascendingClass),e.removeClassName(i.descendingClass),t===r&&(n===1?e.addClassName(i.ascendingClass):e.addClassName(i.descendingClass))})},types:{},detectors:[],addSortType:function(){$A(arguments).each(function(e){TableKit.Sortable.types[e.name]=e})},getDataType:function(e,t,n){e=$(e),t=t||t===0?t:TableKit.getCellIndex(e);var r=TableKit.Sortable._coltypecache,i=r[n.id]?r[n.id]:r[n.id]={};if(!i[t]){var s=!1;e.id&&TableKit.Sortable.types[e.id]&&(s=e.id),s||(s=$w(e.className).detect(function(e){return TableKit.Sortable.types[e]?!0:!1}));if(!s){var o=TableKit.getBodyRows(n);e=o[0].cells[t],s=TableKit.Sortable.detectors.detect(function(t){return TableKit.Sortable.types[t].detect(TableKit.getCellText(e))})}i[t]=s}return i[t]},_coltypecache:{}},TableKit.Sortable.detectors=$A($w("date-iso date date-eu date-au time currency datasize number casesensitivetext text")),TableKit.Sortable.Type=Class.create(),TableKit.Sortable.Type.prototype={initialize:function(e,t){this.name=e,t=Object.extend({normal:function(e){return e},pattern:/.*/},t||{}),this.normal=t.normal,this.pattern=t.pattern,t.compare&&(this.compare=t.compare),t.detect&&(this.detect=t.detect)},compare:function(e,t){return TableKit.Sortable.Type.compare(this.normal(e),this.normal(t))},detect:function(e){return this.pattern.test(e)}},TableKit.Sortable.Type.compare=function(e,t){return e<t?-1:e===t?0:1},TableKit.Sortable.addSortType(new TableKit.Sortable.Type("number",{pattern:/^[-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?/,normal:function(e){return e=parseFloat(e.replace(/^.*?([-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?).*$/,"$1")),isNaN(e)?0:e}}),new TableKit.Sortable.Type("text",{normal:function(e){return e?e.toLowerCase():""}}),new TableKit.Sortable.Type("casesensitivetext",{pattern:/^[A-Z]+$/}),new TableKit.Sortable.Type("datasize",{pattern:/^[-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?\s?[k|m|g|t]b$/i,normal:function(e){var t=e.match(/^([-+]?[\d]*\.?[\d]+([eE][-+]?[\d]+)?)\s?([k|m|g|t]?b)?/i),n=t[1]?Number(t[1]).valueOf():0,r=t[3]?t[3].substr(0,1).toLowerCase():"",i=n;switch(r){case"k":i=n*1024;break;case"m":i=n*1024*1024;break;case"g":i=n*1024*1024*1024;break;case"t":i=n*1024*1024*1024*1024}return i}}),new TableKit.Sortable.Type("date-au",{pattern:/^\d{2}\/\d{2}\/\d{4}\s?(?:\d{1,2}\:\d{2}(?:\:\d{2})?\s?[a|p]?m?)?/i,normal:function(e){if(!this.pattern.test(e))return 0;var t=e.match(/^(\d{2})\/(\d{2})\/(\d{4})\s?(?:(\d{1,2})\:(\d{2})(?:\:(\d{2}))?\s?([a|p]?m?))?/i),n=t[3],r=parseInt(t[2],10)-1,i=t[1],s=t[4]?t[4]:0;if(t[7]){var o=parseInt(t[4],10);t[7].toLowerCase().indexOf("p")!==-1?s=o<12?o+12:o:t[7].toLowerCase().indexOf("a")!==-1&&(s=o<12?o:0)}var u=t[5]?t[5]:0,a=t[6]?t[6]:0;return(new Date(n,r,i,s,u,a,0)).valueOf()}}),new TableKit.Sortable.Type("date-us",{pattern:/^\d{2}\/\d{2}\/\d{4}\s?(?:\d{1,2}\:\d{2}(?:\:\d{2})?\s?[a|p]?m?)?/i,normal:function(e){if(!this.pattern.test(e))return 0;var t=e.match(/^(\d{2})\/(\d{2})\/(\d{4})\s?(?:(\d{1,2})\:(\d{2})(?:\:(\d{2}))?\s?([a|p]?m?))?/i),n=t[3],r=parseInt(t[1],10)-1,i=t[2],s=t[4]?t[4]:0;if(t[7]){var o=parseInt(t[4],10);t[7].toLowerCase().indexOf("p")!==-1?s=o<12?o+12:o:t[7].toLowerCase().indexOf("a")!==-1&&(s=o<12?o:0)}var u=t[5]?t[5]:0,a=t[6]?t[6]:0;return(new Date(n,r,i,s,u,a,0)).valueOf()}}),new TableKit.Sortable.Type("date-eu",{pattern:/^\d{2}-\d{2}-\d{4}/i,normal:function(e){if(!this.pattern.test(e))return 0;var t=e.match(/^(\d{2})-(\d{2})-(\d{4})/),n=t[3],r=parseInt(t[2],10)-1,i=t[1];return(new Date(n,r,i)).valueOf()}}),new TableKit.Sortable.Type("date-iso",{pattern:/[\d]{4}-[\d]{2}-[\d]{2}(?:T[\d]{2}\:[\d]{2}(?:\:[\d]{2}(?:\.[\d]+)?)?(Z|([-+][\d]{2}:[\d]{2})?)?)?/,normal:function(e){if(!this.pattern.test(e))return 0;var t=e.match(/([\d]{4})(-([\d]{2})(-([\d]{2})(T([\d]{2}):([\d]{2})(:([\d]{2})(\.([\d]+))?)?(Z|(([-+])([\d]{2}):([\d]{2})))?)?)?)?/),n=0,r=new Date(t[1],0,1);t[3]&&r.setMonth(t[3]-1),t[5]&&r.setDate(t[5]),t[7]&&r.setHours(t[7]),t[8]&&r.setMinutes(t[8]),t[10]&&r.setSeconds(t[10]),t[12]&&r.setMilliseconds(Number("0."+t[12])*1e3),t[14]&&(n=Number(t[16])*60+Number(t[17]),n*=t[15]==="-"?1:-1),n-=r.getTimezoneOffset();if(n!==0){var i=Number(r)+n*60*1e3;r.setTime(Number(i))}return r.valueOf()}}),new TableKit.Sortable.Type("date",{pattern:/^(?:sun|mon|tue|wed|thu|fri|sat)\,\s\d{1,2}\s(?:jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\s\d{4}(?:\s\d{2}\:\d{2}(?:\:\d{2})?(?:\sGMT(?:[+-]\d{4})?)?)?/i,compare:function(e,t){return e&&t?TableKit.Sortable.Type.compare(new Date(e),new Date(t)):TableKit.Sortable.Type.compare(e?1:0,t?1:0)}}),new TableKit.Sortable.Type("time",{pattern:/^\d{1,2}\:\d{2}(?:\:\d{2})?(?:\s[a|p]m)?$/i,compare:function(e,t){var n=new Date,r=n.getMonth()+"/"+n.getDate()+"/"+n.getFullYear()+" ";return TableKit.Sortable.Type.compare(new Date(r+e),new Date(r+t))}}),new TableKit.Sortable.Type("currency",{pattern:/^[$����]/,normal:function(e){return e?parseFloat(e.replace(/[^-\d\.]/g,"")):0}})),TableKit.Resizable={init:function(e,t){var n=$(e);if(n.tagName!=="TABLE")return;TableKit.register(n,Object.extend(t||{},{resizable:!0}));var r=TableKit.getHeaderCells(n);r.each(function(e){e=$(e),e.id!="actions"&&(Event.observe(e,"mouseover",TableKit.Resizable.initDetect),Event.observe(e,"mouseout",TableKit.Resizable.killDetect))})},resize:function(e,t,n){var r;if(typeof t=="number"){if(!e||e.tagName&&e.tagName!=="TABLE")return;e=$(e),t=Math.min(e.rows[0].cells.length,t),t=Math.max(1,t),t-=1,r=e.tHead&&e.tHead.rows.length>0?$(e.tHead.rows[e.tHead.rows.length-1].cells[t]):$(e.rows[0].cells[t])}else r=$(t),e=e?$(e):r.up("table"),t=TableKit.getCellIndex(r);var i=parseInt(r.getStyle("paddingLeft"),10)+parseInt(r.getStyle("paddingRight"),10);n=Math.max(n-i,TableKit.option("minWidth",e.id)[0]),r.setStyle({width:n+"px"})},initDetect:function(e){e=TableKit.e(e);var t=Event.element(e);Event.observe(t,"mousemove",TableKit.Resizable.detectHandle),Event.observe(t,"mousedown",TableKit.Resizable.startResize)},detectHandle:function(e){e=TableKit.e(e);var t=Event.element(e);TableKit.Resizable.pointerPos(t,Event.pointerX(e),Event.pointerY(e))?(t.addClassName(TableKit.option("resizeOnHandleClass",t.up("table").id)[0]),TableKit.Resizable._onHandle=!0):(t.removeClassName(TableKit.option("resizeOnHandleClass",t.up("table").id)[0]),TableKit.Resizable._onHandle=!1)},killDetect:function(e){e=TableKit.e(e),TableKit.Resizable._onHandle=!1;var t=Event.element(e);Event.stopObserving(t,"mousemove",TableKit.Resizable.detectHandle),Event.stopObserving(t,"mousedown",TableKit.Resizable.startResize),t.removeClassName(TableKit.option("resizeOnHandleClass",t.up("table").id)[0])},startResize:function(e){e=TableKit.e(e);if(!TableKit.Resizable._onHandle)return;var t=Event.element(e);Event.stopObserving(t,"mousemove",TableKit.Resizable.detectHandle),Event.stopObserving(t,"mousedown",TableKit.Resizable.startResize),Event.stopObserving(t,"mouseout",TableKit.Resizable.killDetect),TableKit.Resizable._cell=t;var n=t.up("table");TableKit.Resizable._tbl=n,TableKit.option("showHandle",n.id)[0]&&(TableKit.Resizable._handle=$(document.createElement("div")).addClassName("resize-handle").setStyle({top:t.cumulativeOffset()[1]+"px",left:Event.pointerX(e)+"px",height:n.getDimensions().height+"px"}),document.body.appendChild(TableKit.Resizable._handle)),Event.observe(document,"mousemove",TableKit.Resizable.drag),Event.observe(document,"mouseup",TableKit.Resizable.endResize),Event.stop(e)},endResize:function(e){e=TableKit.e(e);var t=TableKit.Resizable._cell;TableKit.Resizable.resize(null,t,Event.pointerX(e)-t.cumulativeOffset()[0]),Event.stopObserving(document,"mousemove",TableKit.Resizable.drag),Event.stopObserving(document,"mouseup",TableKit.Resizable.endResize),TableKit.option("showHandle",TableKit.Resizable._tbl.id)[0]&&$$("div.resize-handle").each(function(e){document.body.removeChild(e)}),Event.observe(t,"mouseout",TableKit.Resizable.killDetect),TableKit.Resizable._tbl=TableKit.Resizable._handle=TableKit.Resizable._cell=null,Event.stop(e)},drag:function(e){e=TableKit.e(e);if(TableKit.Resizable._handle===null)try{TableKit.Resizable.resize(TableKit.Resizable._tbl,TableKit.Resizable._cell,Event.pointerX(e)-TableKit.Resizable._cell.cumulativeOffset()[0])}catch(e){}else TableKit.Resizable._handle.setStyle({left:Event.pointerX(e)+"px"});return!1},pointerPos:function(e,t,n){var r=$(e).cumulativeOffset();return n>=r[1]&&n<r[1]+e.offsetHeight&&t>=r[0]+e.offsetWidth-5&&t<r[0]+e.offsetWidth},_onHandle:!1,_cell:null,_tbl:null,_handle:null},TableKit.Editable={init:function(e,t){var n=$(e);if(n.tagName!=="TABLE")return;TableKit.register(n,Object.extend(t||{},{editable:!0})),Event.observe(n.tBodies[0],"click",TableKit.Editable._editCell)},_editCell:function(e){e=TableKit.e(e);var t=Event.findElement(e,"td");if(!t)return!1;TableKit.Editable.editCell(null,t,null,e)},editCell:function(e,t,n,r){var i,s;if(typeof t=="number"){if(!e||e.tagName&&e.tagName!=="TABLE")return;e=$(e),t=Math.min(e.tBodies[0].rows.length,t),t=Math.max(1,t),t-=1,n=Math.min(e.rows[0].cells.length,n),n=Math.max(1,n),n-=1,s=$(e.tBodies[0].rows[t]),i=$(s.cells[n])}else i=$(r?Event.findElement(r,"td"):t),e=e&&e.tagName&&e.tagName!=="TABLE"?$(e):i.up("table"),s=i.up("tr");var o=TableKit.option("noEditClass",e.id);if(i.hasClassName(o.noEditClass))return;var u=$(TableKit.getHeaderCells(e,i)[TableKit.getCellIndex(i)]);if(u.hasClassName(o.noEditClass))return;var a=TableKit.getCellData(i);if(a.active)return;a.htmlContent=i.innerHTML;var f=TableKit.Editable.getCellEditor(null,null,u);f.edit(i,r),a.active=!0},getCellEditor:function(e,t,n){var n=n?n:$(TableKit.getHeaderCells(t,e)[TableKit.getCellIndex(e)]),r=TableKit.Editable.types["text-input"];if(n.id&&TableKit.Editable.types[n.id])r=TableKit.Editable.types[n.id];else{var i=$w(n.className).detect(function(e){return TableKit.Editable.types[e]?!0:!1});r=i?TableKit.Editable.types[i]:r}return r},types:{},addCellEditor:function(e){e&&e.name&&(TableKit.Editable.types[e.name]=e)}},TableKit.Editable.CellEditor=Class.create(),TableKit.Editable.CellEditor.prototype={initialize:function(e,t){this.name=e,this.options=Object.extend({element:"input",attributes:{name:"value",type:"text"},selectOptions:[],showSubmit:!0,submitText:"OK",showCancel:!0,cancelText:"Cancel",ajaxURI:null,ajaxOptions:null},t||{})},edit:function(e){e=$(e);if(e.hasClassName("static"))return;var t=this.options,n=e.up("table"),r=$(document.createElement("form"));r.id=e.id+"-form",r.addClassName(TableKit.option("formClassName",n.id)[0]),r.onsubmit=this._submit.bindAsEventListener(this);var i=document.createElement(t.element);$H(t.attributes).each(function(e){i[e.key]=e.value});switch(t.element){case"input":case"textarea":i.value=TableKit.getCellText(e);break;case"select":var s=TableKit.getCellText(e);$A(t.selectOptions).each(function(e){i.options[i.options.length]=new Option(e[0],e[1]),s===e[1]&&(i.options[i.options.length-1].selected="selected")})}r.appendChild(i),t.element==="textarea"&&r.appendChild(document.createElement("br"));if(t.showSubmit){var o=document.createElement("input");o.type="submit",o.value=t.submitText,o.className="editor_ok_button",r.appendChild(o)}if(t.showCancel){var u=document.createElement("a");u.href="#",u.appendChild(document.createTextNode(t.cancelText)),u.onclick=this._cancel.bindAsEventListener(this),u.className="editor_cancel",r.appendChild(u)}e.innerHTML="",e.appendChild(r)},_submit:function(e){var t=Event.findElement(e,"td"),n=Event.findElement(e,"form");Event.stop(e),this.submit(t,n)},submit:function(e,t){if(!n.ajaxURI&&!TableKit.option("editAjaxURI",s.id)[0]){e.update(t);return}var n=this.options;t=t?t:e.down("form");var r=$(TableKit.getHeaderCells(null,e)[TableKit.getCellIndex(e)]),i=e.up("tr"),s=e.up("table"),o="&row="+(TableKit.getRowIndex(i)+1)+"&cell="+(TableKit.getCellIndex(e)+1)+"&id="+i.id+"&field="+r.id+"&"+Form.serialize(t);this.ajax=new Ajax.Updater(e,n.ajaxURI||TableKit.option("editAjaxURI",s.id)[0],Object.extend(n.ajaxOptions||TableKit.option("editAjaxOptions",s.id)[0],{postBody:o,onComplete:function(){var t=TableKit.getCellData(e);t.active=!1,t.refresh=!0}}))},_cancel:function(e){var t=Event.findElement(e,"td");Event.stop(e),this.cancel(t)},cancel:function(e){this.ajax=null;var t=TableKit.getCellData(e);e.innerHTML=t.htmlContent,t.htmlContent="",t.active=!1},ajax:null},TableKit.Editable.textInput=function(e,t){TableKit.Editable.addCellEditor(new TableKit.Editable.CellEditor(e,{element:"input",attributes:Object.extend({name:"value",type:"text"},t||{})}))},TableKit.Editable.textInput("text-input"),TableKit.Editable.multiLineInput=function(e,t){TableKit.Editable.addCellEditor(new TableKit.Editable.CellEditor(e,{element:"textarea",attributes:Object.extend({name:"value",rows:"5",cols:"20"},t||{})}))},TableKit.Editable.multiLineInput("multi-line-input"),TableKit.Editable.selectInput=function(e,t,n){TableKit.Editable.addCellEditor(new TableKit.Editable.CellEditor(e,{element:"select",attributes:Object.extend({name:"value"},t||{}),selectOptions:n}))},Object.extend(TableKit.options||{},{trueResize:!1,keepWidth:!1}),Object.extend(TableKit.Resizable,{resize:function(e,t,n){var r;if(typeof t=="number"){if(!e||e.tagName&&e.tagName!=="TABLE")return;e=$(e),t=Math.min(e.rows[0].cells.length,t),t=Math.max(1,t),t-=1,r=e.tHead&&e.tHead.rows.length>0?$(e.tHead.rows[e.tHead.rows.length-1].cells[t]):$(e.rows[0].cells[t])}else r=$(t),e=e?$(e):r.up("table"),t=TableKit.getCellIndex(r);var i=TableKit.option("trueResize keepWidth minWidth",e.id),s=parseInt(r.getStyle("paddingLeft"),10)+parseInt(r.getStyle("paddingRight"),10);s+=parseInt(r.getStyle("borderLeftWidth"),10)+parseInt(r.getStyle("borderRightWidth"),10),n=Math.max(n-s,i.minWidth);if(!i.trueResize)r.setStyle({width:n+"px"});else{var o=n+s-parseInt(r.getWidth());if(!i.keepWidth){var u=parseInt(e.getWidth())+o;r.setStyle({width:n+"px"}),e.setStyle({width:u+"px"})}else{var a=TableKit.getHeaderCells(e);if(t<0||t>a.length)return;var f;t==a.length-1?f=a[t-1]:f=a[t+1];var l=parseInt(f.getWidth()),c=parseInt(f.getStyle("paddingLeft"),10)+parseInt(f.getStyle("paddingRight"),10),h=l-c-o,p;h<i.minWidth?(p=Math.min(l-c,i.minWidth),n-=p-h):p=h,f.setStyle({width:p+"px"}),r.setStyle({width:n+"px"})}}}}),document.observe("dom:loaded",TableKit.load);var qq=qq||{};qq.extend=function(e,t){for(var n in t)e[n]=t[n]},qq.indexOf=function(e,t,n){if(e.indexOf)return e.indexOf(t,n);n=n||0;var r=e.length;n<0&&(n+=r);for(;n<r;n++)if(n in e&&e[n]===t)return n;return-1},qq.getUniqueId=function(){var e=0;return function(){return e++}}(),qq.attach=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},qq.detach=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&e.detachEvent("on"+t,n)},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.insertBefore=function(e,t){t.parentNode.insertBefore(e,t)},qq.remove=function(e){e.parentNode.removeChild(e)},qq.contains=function(e,t){return e==t?!0:e.contains?e.contains(t):!!(t.compareDocumentPosition(e)&8)},qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;return e.removeChild(n),n}}(),qq.css=function(e,t){t.opacity!=null&&typeof e.style.opacity!="string"&&typeof e.filters!="undefined"&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t)},qq.hasClass=function(e,t){var n=new RegExp("(^| )"+t+"( |$)");return n.test(e.className)},qq.addClass=function(e,t){qq.hasClass(e,t)||(e.className+=" "+t)},qq.removeClass=function(e,t){var n=new RegExp("(^| )"+t+"( |$)");e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,"")},qq.setText=function(e,t){e.innerText=t,e.textContent=t},qq.children=function(e){var t=[],n=e.firstChild;while(n)n.nodeType==1&&t.push(n),n=n.nextSibling;return t},qq.getByClass=function(e,t){if(e.querySelectorAll)return e.querySelectorAll("."+t);var n=[],r=e.getElementsByTagName("*"),i=r.length;for(var s=0;s<i;s++)qq.hasClass(r[s],t)&&n.push(r[s]);return n},qq.obj2url=function(e,t,n){var r=[],i="&",s=function(e,n){var i=t?/\[\]$/.test(t)?t:t+"["+n+"]":n;i!="undefined"&&n!="undefined"&&r.push(typeof e=="object"?qq.obj2url(e,i,!0):Object.prototype.toString.call(e)==="[object Function]"?encodeURIComponent(i)+"="+encodeURIComponent(e()):encodeURIComponent(i)+"="+encodeURIComponent(e))};if(!n&&t)i=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",r.push(t),r.push(qq.obj2url(e));else if(Object.prototype.toString.call(e)==="[object Array]"&&typeof e!="undefined")for(var o=0,u=e.length;o<u;++o)s(e[o],o);else if(typeof e!="undefined"&&e!==null&&typeof e=="object")for(var o in e)s(e[o],o);else r.push(encodeURIComponent(t)+"="+encodeURIComponent(e));return r.join(i).replace(/^&/,"").replace(/%20/g,"+")};var qq=qq||{};qq.FileUploaderBasic=function(e){this._options={debug:!1,action:"/server/upload",params:{},button:null,multiple:!0,maxConnections:3,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(e,t){},onProgress:function(e,t,n,r){},onComplete:function(e,t,n){},onCancel:function(e,t){},messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(e){}},qq.extend(this._options,e),this._filesInProgress=0,this._handler=this._createUploadHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._preventLeaveInProgress()},qq.FileUploaderBasic.prototype={setParams:function(e){this._options.params=e},getInProgress:function(){return this._filesInProgress},_createUploadButton:function(e){var t=this;return new qq.UploadButton({element:e,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(e){t._onInputChange(e)}})},_createUploadHandler:function(){var e=this,t;qq.UploadHandlerXhr.isSupported()?t="UploadHandlerXhr":t="UploadHandlerForm";var n=new qq[t]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(t,n,r,i){e._onProgress(t,n,r,i),e._options.onProgress(t,n,r,i)},onComplete:function(t,n,r){e._onComplete(t,n,r),e._options.onComplete(t,n,r)},onCancel:function(t,n){e._onCancel(t,n),e._options.onCancel(t,n)}});return n},_preventLeaveInProgress:function(){var e=this;qq.attach(window,"beforeunload",function(t){if(!e._filesInProgress)return;var t=t||window.event;return t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave})},_onSubmit:function(e,t){this._filesInProgress++},_onProgress:function(e,t,n,r){},_onComplete:function(e,t,n){this._filesInProgress--,n.error&&this._options.showMessage(n.error)},_onCancel:function(e,t){this._filesInProgress--},_onInputChange:function(e){this._handler instanceof qq.UploadHandlerXhr?this._uploadFileList(e.files):this._validateFile(e)&&this._uploadFile(e),this._button.reset()},_uploadFileList:function(e){for(var t=0;t<e.length;t++)if(!this._validateFile(e[t]))return;for(var t=0;t<e.length;t++)this._uploadFile(e[t])},_uploadFile:function(e){var t=this._handler.add(e),n=this._handler.getName(t);this._options.onSubmit(t,n)!==!1&&(this._onSubmit(t,n),this._handler.upload(t,this._options.params))},_validateFile:function(e){var t,n;return e.value?t=e.value.replace(/.*(\/|\\)/,""):(t=e.fileName!=null?e.fileName:e.name,n=e.fileSize!=null?e.fileSize:e.size),this._isAllowedExtension(t)?n===0?(this._error("emptyError",t),!1):n&&this._options.sizeLimit&&n>this._options.sizeLimit?(this._error("sizeError",t),!1):n&&n<this._options.minSizeLimit?(this._error("minSizeError",t),!1):!0:(this._error("typeError",t),!1)},_error:function(e,t){function r(e,t){n=n.replace(e,t)}var n=this._options.messages[e];r("{file}",this._formatFileName(t)),r("{extensions}",this._options.allowedExtensions.join(", ")),r("{sizeLimit}",this._formatSize(this._options.sizeLimit)),r("{minSizeLimit}",this._formatSize(this._options.minSizeLimit)),this._options.showMessage(n)},_formatFileName:function(e){return e.length>33&&(e=e.slice(0,19)+"..."+e.slice(-13)),e},_isAllowedExtension:function(e){var t=-1!==e.indexOf(".")?e.replace(/.*[.]/,"").toLowerCase():"",n=this._options.allowedExtensions;if(!n.length)return!0;for(var r=0;r<n.length;r++)if(n[r].toLowerCase()==t)return!0;return!1},_formatSize:function(e){var t=-1;do e/=1024,t++;while(e>99);return Math.max(e,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][t]}},qq.FileUploader=function(e){qq.FileUploaderBasic.apply(this,arguments),qq.extend(this._options,{element:null,listElement:null,template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button">Upload a file</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"}}),qq.extend(this._options,e),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button=this._createUploadButton(this._find(this._element,"button")),this._bindCancelEvent(),this._setupDragDrop()},qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype),qq.extend(qq.FileUploader.prototype,{_find:function(e,t){var n=qq.getByClass(e,this._options.classes[t])[0];if(!n)throw new Error("element not found "+t);return n},_setupDragDrop:function(){var e=this,t=this._find(this._element,"drop"),n=new qq.UploadDropZone({element:t,onEnter:function(n){qq.addClass(t,e._classes.dropActive),n.stopPropagation()},onLeave:function(e){e.stopPropagation()},onLeaveNotDescendants:function(n){qq.removeClass(t,e._classes.dropActive)},onDrop:function(n){t.style.display="none",qq.removeClass(t,e._classes.dropActive),e._uploadFileList(n.dataTransfer.files)}});t.style.display="none",qq.attach(document,"dragenter",function(e){if(!n._isValidFileDrag(e))return;t.style.display="block"}),qq.attach(document,"dragleave",function(e){if(!n._isValidFileDrag(e))return;var r=document.elementFromPoint(e.clientX,e.clientY);if(!r||r.nodeName=="HTML")t.style.display="none"})},_onSubmit:function(e,t){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onProgress:function(e,t,n,r){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var i=this._getItemByFileId(e),s=this._find(i,"size");s.style.display="inline";var o;n!=r?o=Math.round(n/r*100)+"% from "+this._formatSize(r):o=this._formatSize(r),qq.setText(s,o)},_onComplete:function(e,t,n){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var r=this._getItemByFileId(e);n.success?Notifications.Display(2,"File "+t+" successfully uploaded"):n.error&&Notifications.Display(5,n.error),qq.remove(r)},_addToList:function(e,t){var n=qq.toElement(this._options.fileTemplate);n.qqFileId=e;var r=this._find(n,"file");qq.setText(r,this._formatFileName(t)),this._find(n,"size").style.display="none",this._listElement.appendChild(n)},_getItemByFileId:function(e){var t=this._listElement.firstChild;while(t){if(t.qqFileId==e)return t;t=t.nextSibling}},_bindCancelEvent:function(){var e=this,t=this._listElement;qq.attach(t,"click",function(t){t=t||window.event;var n=t.target||t.srcElement;if(qq.hasClass(n,e._classes.cancel)){qq.preventDefault(t);var r=n.parentNode;e._handler.cancel(r.qqFileId),qq.remove(r)}})}}),qq.UploadDropZone=function(e){this._options={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}},qq.extend(this._options,e),this._element=this._options.element,this._disableDropOutside(),this._attachEvents()},qq.UploadDropZone.prototype={_disableDropOutside:function(e){qq.UploadDropZone.dropOutsideDisabled||(qq.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),qq.UploadDropZone.dropOutsideDisabled=!0)},_attachEvents:function(){var e=this;qq.attach(e._element,"dragover",function(t){if(!e._isValidFileDrag(t))return;var n=t.dataTransfer.effectAllowed;n=="move"||n=="linkMove"?t.dataTransfer.dropEffect="move":t.dataTransfer.dropEffect="copy",t.stopPropagation(),t.preventDefault()}),qq.attach(e._element,"dragenter",function(t){if(!e._isValidFileDrag(t))return;e._options.onEnter(t)}),qq.attach(e._element,"dragleave",function(t){if(!e._isValidFileDrag(t))return;e._options.onLeave(t);var n=document.elementFromPoint(t.clientX,t.clientY);if(qq.contains(this,n))return;e._options.onLeaveNotDescendants(t)}),qq.attach(e._element,"drop",function(t){if(!e._isValidFileDrag(t))return;t.preventDefault(),e._options.onDrop(t)})},_isValidFileDrag:function(e){var t=e.dataTransfer,n=navigator.userAgent.indexOf("AppleWebKit")>-1;return t&&t.effectAllowed!="none"&&(t.files||!n&&t.types.contains&&t.types.contains("Files"))}},qq.UploadButton=function(e){this._options={element:null,multiple:!1,name:"file",onChange:function(e){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},qq.extend(this._options,e),this._element=this._options.element,qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"}),this._input=this._createInput()},qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&qq.remove(this._input),qq.removeClass(this._element,this._options.focusClass),this._input=this._createInput()},_createInput:function(){var e=document.createElement("input");this._options.multiple&&e.setAttribute("multiple","multiple"),e.setAttribute("type","file"),e.setAttribute("name",this._options.name),qq.css(e,{position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),this._element.appendChild(e);var t=this;return qq.attach(e,"change",function(){t._options.onChange(e)}),qq.attach(e,"mouseover",function(){qq.addClass(t._element,t._options.hoverClass)}),qq.attach(e,"mouseout",function(){qq.removeClass(t._element,t._options.hoverClass)}),qq.attach(e,"focus",function(){qq.addClass(t._element,t._options.focusClass)}),qq.attach(e,"blur",function(){qq.removeClass(t._element,t._options.focusClass)}),window.attachEvent&&e.setAttribute("tabIndex","-1"),e}},qq.UploadHandlerAbstract=function(e){this._options={debug:!1,action:"/upload.php",maxConnections:999,onProgress:function(e,t,n,r){},onComplete:function(e,t,n){},onCancel:function(e,t){}},qq.extend(this._options,e),this._queue=[],this._params=[]},qq.UploadHandlerAbstract.prototype={log:function(e){this._options.debug&&window.console&&console.log("[uploader] "+e)},add:function(e){},upload:function(e,t){var n=this._queue.push(e),r={};qq.extend(r,t),this._params[e]=r,n<=this._options.maxConnections&&this._upload(e,this._params[e])},cancel:function(e){this._cancel(e),this._dequeue(e)},cancelAll:function(){for(var e=0;e<this._queue.length;e++)this._cancel(this._queue[e]);this._queue=[]},getName:function(e){},getSize:function(e){},getQueue:function(){return this._queue},_upload:function(e){},_cancel:function(e){},_dequeue:function(e){var t=qq.indexOf(this._queue,e);this._queue.splice(t,1);var n=this._options.maxConnections;if(this._queue.length>=n){var r=this._queue[n-1];this._upload(r,this._params[r])}}},qq.UploadHandlerForm=function(e){qq.UploadHandlerAbstract.apply(this,arguments),this._inputs={}},qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerForm.prototype,{add:function(e){e.setAttribute("name","qqfile");var t="qq-upload-handler-iframe"+qq.getUniqueId();return this._inputs[t]=e,e.parentNode&&qq.remove(e),t},getName:function(e){return this._inputs[e].value.replace(/.*(\/|\\)/,"")},_cancel:function(e){this._options.onCancel(e,this.getName(e)),delete this._inputs[e];var t=document.getElementById(e);t&&(t.setAttribute("src","javascript:false;"),qq.remove(t))},_upload:function(e,t){var n=this._inputs[e];if(!n)throw new Error("file with passed id was not added, or already uploaded or cancelled");var r=this.getName(e),i=this._createIframe(e),s=this._createForm(i,t);s.appendChild(n);var o=this;return this._attachLoadEvent(i,function(){o.log("iframe loaded");var t=o._getIframeContentJSON(i);o._options.onComplete(e,r,t),o._dequeue(e),delete o._inputs[e],setTimeout(function(){qq.remove(i)},1)}),s.submit(),qq.remove(s),e},_attachLoadEvent:function(e,t){qq.attach(e,"load",function(){if(!e.parentNode)return;if(e.contentDocument&&e.contentDocument.body&&e.contentDocument.body.innerHTML=="false")return;t()})},_getIframeContentJSON:function(iframe){var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON"),this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")")}catch(err){response={}}return response},_createIframe:function(e){var t=qq.toElement('<iframe src="javascript:false;" name="'+e+'" />');return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t},_createForm:function(e,t){var n=qq.toElement('<form method="post" enctype="multipart/form-data"></form>'),r=qq.obj2url(t,this._options.action);return n.setAttribute("action",r),n.setAttribute("target",e.name),n.style.display="none",document.body.appendChild(n),n}}),qq.UploadHandlerXhr=function(e){qq.UploadHandlerAbstract.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},qq.UploadHandlerXhr.isSupported=function(){var e=document.createElement("input");return e.type="file","multiple"in e&&typeof File!="undefined"&&typeof (new XMLHttpRequest).upload!="undefined"},qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerXhr.prototype,{add:function(e){if(e instanceof File)return this._files.push(e)-1;throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)")},getName:function(e){var t=this._files[e];return t.fileName!=null?t.fileName:t.name},getSize:function(e){var t=this._files[e];return t.fileSize!=null?t.fileSize:t.size},getLoaded:function(e){return this._loaded[e]||0},_upload:function(e,t){var n=this._files[e],r=this.getName(e),i=this.getSize(e);this._loaded[e]=0;var s=this._xhrs[e]=new XMLHttpRequest,o=this;s.upload.onprogress=function(t){t.lengthComputable&&(o._loaded[e]=t.loaded,o._options.onProgress(e,r,t.loaded,t.total))},s.onreadystatechange=function(){s.readyState==4&&o._onComplete(e,s)},t=t||{},t.qqfile=r;var u=qq.obj2url(t,this._options.action);s.open("POST",u,!0),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.setRequestHeader("X-File-Name",encodeURIComponent(r)),s.setRequestHeader("Content-Type","application/octet-stream"),s.send(n)},_onComplete:function(id,xhr){if(!this._files[id])return;var name=this.getName(id),size=this.getSize(id);this._options.onProgress(id,name,size,size);if(xhr.status==200){this.log("xhr - server response received"),this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}}this._options.onComplete(id,name,response)}else this._options.onComplete(id,name,{});this._files[id]=null,this._xhrs[id]=null,this._dequeue(id)},_cancel:function(e){this._options.onCancel(e,this.getName(e)),this._files[e]=null,this._xhrs[e]&&(this._xhrs[e].abort(),this._xhrs[e]=null)}});if(!Control)var Control={};Control.Slider=Class.create({initialize:function(e,t,n){var r=this;Object.isArray(e)?this.handles=e.collect(function(e){return $(e)}):this.handles=[$(e)],this.track=$(t),this.options=n||{},this.axis=this.options.axis||"horizontal",this.increment=this.options.increment||1,this.step=parseInt(this.options.step||"1"),this.range=this.options.range||$R(0,1),this.value=0,this.values=this.handles.map(function(){return 0}),this.spans=this.options.spans?this.options.spans.map(function(e){return $(e)}):!1,this.options.startSpan=$(this.options.startSpan||null),this.options.endSpan=$(this.options.endSpan||null),this.restricted=this.options.restricted||!1,this.maximum=this.options.maximum||this.range.end,this.minimum=this.options.minimum||this.range.start,this.alignX=parseInt(this.options.alignX||"0"),this.alignY=parseInt(this.options.alignY||"0"),this.trackLength=this.maximumOffset()-this.minimumOffset(),this.handleLength=this.isVertical()?this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,""):this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""),this.active=!1,this.dragging=!1,this.disabled=!1,this.options.disabled&&this.setDisabled(),this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):!1,this.allowedValues&&(this.minimum=this.allowedValues.min(),this.maximum=this.allowedValues.max()),this.eventMouseDown=this.startDrag.bindAsEventListener(this),this.eventMouseUp=this.endDrag.bindAsEventListener(this),this.eventMouseMove=this.update.bindAsEventListener(this),this.handles.each(function(e,t){t=r.handles.length-1-t,r.setValue(parseFloat((Object.isArray(r.options.sliderValue)?r.options.sliderValue[t]:r.options.sliderValue)||r.range.start),t),e.makePositioned().observe("mousedown",r.eventMouseDown),e.observe("touchstart",r.eventMouseDown)}),this.track.observe("mousedown",this.eventMouseDown),this.track.observe("touchstart",this.eventMouseDown),document.observe("mouseup",this.eventMouseUp),document.observe("touchend",this.eventMouseUp),document.observe("mousemove",this.eventMouseMove),document.observe("touchmove",this.eventMouseMove),this.initialized=!0},dispose:function(){var e=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown),Event.stopObserving(this.track,"touchstart",this.eventMouseDown),Event.stopObserving(document,"mouseup",this.eventMouseUp),Event.stopObserving(document,"touchend",this.eventMouseUp),Event.stopObserving(document,"mousemove",this.eventMouseMove),Event.stopObserving(document,"touchmove",this.eventMouseMove),this.handles.each(function(t){Event.stopObserving(t,"mousedown",e.eventMouseDown),Event.stopObserving(t,"touchstart",e.eventMouseDown)})},setDisabled:function(){this.disabled=!0},setEnabled:function(){this.disabled=!1},getNearestValue:function(e){if(this.allowedValues){if(e>=this.allowedValues.max())return this.allowedValues.max();if(e<=this.allowedValues.min())return this.allowedValues.min();var t=Math.abs(this.allowedValues[0]-e),n=this.allowedValues[0];return this.allowedValues.each(function(r){var i=Math.abs(r-e);i<=t&&(n=r,t=i)}),n}return e>this.range.end?this.range.end:e<this.range.start?this.range.start:e},setValue:function(e,t){this.active||(this.activeHandleIdx=t||0,this.activeHandle=this.handles[this.activeHandleIdx],this.updateStyles()),t=t||this.activeHandleIdx||0,this.initialized&&this.restricted&&(t>0&&e<this.values[t-1]&&(e=this.values[t-1]),t<this.handles.length-1&&e>this.values[t+1]&&(e=this.values[t+1])),e=this.getNearestValue(e),this.values[t]=e,this.value=this.values[0],this.handles[t].style[this.isVertical()?"top":"left"]=this.translateToPx(e),this.drawSpans(),(!this.dragging||!this.event)&&this.updateFinished()},setValueBy:function(e,t){this.setValue(this.values[t||this.activeHandleIdx||0]+e,t||this.activeHandleIdx||0)},translateToPx:function(e){return Math.round((this.trackLength-this.handleLength)/(this.range.end-this.range.start)*(e-this.range.start))+"px"},translateToValue:function(e){return e/(this.trackLength-this.handleLength)*(this.range.end-this.range.start)+this.range.start},getRange:function(e){var t=this.values.sortBy(Prototype.K);return e=e||0,$R(t[e],t[e+1])},minimumOffset:function(){return this.isVertical()?this.alignY:this.alignX},maximumOffset:function(){return this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX},isVertical:function(){return this.axis=="vertical"},drawSpans:function(){var e=this;this.spans&&$R(0,this.spans.length-1).each(function(t){e.setSpan(e.spans[t],e.getRange(t))}),this.options.startSpan&&this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value)),this.options.endSpan&&this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))},setSpan:function(e,t){this.isVertical()?(e.style.top=this.translateToPx(t.start),e.style.height=this.translateToPx(t.end-t.start+this.range.start)):(e.style.left=this.translateToPx(t.start),e.style.width=this.translateToPx(t.end-t.start+this.range.start))},updateStyles:function(){this.handles.each(function(e){Element.removeClassName(e,"selected")}),Element.addClassName(this.activeHandle,"selected")},startDrag:function(e){if(Event.isLeftClick(e)||e.touches){if(!this.disabled){this.active=!0;var t=Event.element(e),n=e.touches?[e.touches[0].clientX,e.touches[0].clientY]:[Event.pointerX(e),Event.pointerY(e)],r=t;if(r==this.track){var i=this.track.cumulativeOffset();this.event=e,this.setValue(this.translateToValue((this.isVertical()?n[1]-i[1]:n[0]-i[0])-this.handleLength/2));var i=this.activeHandle.cumulativeOffset();this.offsetX=n[0]-i[0],this.offsetY=n[1]-i[1]}else{while(this.handles.indexOf(t)==-1&&t.parentNode)t=t.parentNode;if(this.handles.indexOf(t)!=-1){this.activeHandle=t,this.activeHandleIdx=this.handles.indexOf(this.activeHandle),this.updateStyles();var i=this.activeHandle.cumulativeOffset();this.offsetX=n[0]-i[0],this.offsetY=n[1]-i[1]}}}Event.stop(e)}},update:function(e){this.active&&(this.dragging||(this.dragging=!0),this.draw(e),Prototype.Browser.WebKit&&!e.touches&&window.scrollBy(0,0),Event.stop(e))},draw:function(e){var t=e.touches?[e.touches[0].clientX,e.touches[0].clientY]:[Event.pointerX(e),Event.pointerY(e)],n=this.track.cumulativeOffset();t[0]-=this.offsetX+n[0],t[1]-=this.offsetY+n[1],this.event=e,this.setValue(this.translateToValue(this.isVertical()?t[1]:t[0])),this.initialized&&this.options.onSlide&&this.options.onSlide(this.values.length>1?this.values:this.value,this)},endDrag:function(e){this.active&&this.dragging&&(this.finishDrag(e,!0),Event.stop(e)),this.active=!1,this.dragging=!1},finishDrag:function(e,t){this.active=!1,this.dragging=!1,this.updateFinished()},updateFinished:function(){this.initialized&&this.options.onChange&&this.options.onChange(this.values.length>1?this.values:this.value,this),this.event=null}}),String.prototype.parseColor=function(){var e="#";if(this.slice(0,4)=="rgb("){var t=this.slice(4,this.length-1).split(","),n=0;do e+=parseInt(t[n]).toColorPart();while(++n<3)}else if(this.slice(0,1)=="#"){if(this.length==4)for(var n=1;n<4;n++)e+=(this.charAt(n)+this.charAt(n)).toLowerCase();this.length==7&&(e=this.toLowerCase())}return e.length==7?e:arguments[0]||this},Element.collectTextNodes=function(e){return $A($(e).childNodes).collect(function(e){return e.nodeType==3?e.nodeValue:e.hasChildNodes()?Element.collectTextNodes(e):""}).flatten().join("")},Element.collectTextNodesIgnoreClass=function(e,t){return $A($(e).childNodes).collect(function(e){return e.nodeType==3?e.nodeValue:e.hasChildNodes()&&!Element.hasClassName(e,t)?Element.collectTextNodesIgnoreClass(e,t):""}).flatten().join("")},Element.setContentZoom=function(e,t){return e=$(e),e.setStyle({fontSize:t/100+"em"}),Prototype.Browser.WebKit&&window.scrollBy(0,0),e},Element.getInlineOpacity=function(e){return $(e).style.opacity||""},Element.forceRerendering=function(e){try{e=$(e);var t=document.createTextNode(" ");e.appendChild(t),e.removeChild(t)}catch(n){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(e){return-Math.cos(e*Math.PI)/2+.5},reverse:function(e){return 1-e},flicker:function(e){var e=-Math.cos(e*Math.PI)/4+.75+Math.random()/4;return e>1?1:e},wobble:function(e){return-Math.cos(e*Math.PI*9*e)/2+.5},pulse:function(e,t){return-Math.cos(e*((t||5)-.5)*2*Math.PI)/2+.5},spring:function(e){return 1-Math.cos(e*4.5*Math.PI)*Math.exp(-e*6)},none:function(e){return 0},full:function(e){return 1}},DefaultOptions:{duration:1,fps:100,sync:!1,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(e){var t="position:relative";Prototype.Browser.IE&&(t+=";zoom:1"),e=$(e),$A(e.childNodes).each(function(n){n.nodeType==3&&(n.nodeValue.toArray().each(function(r){e.insertBefore((new Element("span",{style:t})).update(r==" "?String.fromCharCode(160):r),n)}),Element.remove(n))})},multiple:function(e,t){var n;(typeof e=="object"||Object.isFunction(e))&&e.length?n=e:n=$(e).childNodes;var r=Object.extend({speed:.1,delay:0},arguments[2]||{}),i=r.delay;$A(n).each(function(e,n){new t(e,Object.extend(r,{delay:n*r.speed+i}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(e,t,n){return e=$(e),t=(t||"appear").toLowerCase(),Effect[Effect.PAIRS[t][e.visible()?1:0]](e,Object.extend({queue:{position:"end",scope:e.id||"global",limit:1}},n||{}))}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal,Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[],this.interval=null},_each:function(e){this.effects._each(e)},add:function(e){var t=(new Date).getTime(),n=Object.isString(e.options.queue)?e.options.queue:e.options.queue.position;switch(n){case"front":this.effects.findAll(function(e){return e.state=="idle"}).each(function(t){t.startOn+=e.finishOn,t.finishOn+=e.finishOn});break;case"with-last":t=this.effects.pluck("startOn").max()||t;break;case"end":t=this.effects.pluck("finishOn").max()||t}e.startOn+=t,e.finishOn+=t,(!e.options.queue.limit||this.effects.length<e.options.queue.limit)&&this.effects.push(e),this.interval||(this.interval=setInterval(this.loop.bind(this),15))},remove:function(e){this.effects=this.effects.reject(function(t){return t==e}),this.effects.length==0&&(clearInterval(this.interval),this.interval=null)},loop:function(){var e=(new Date).getTime();for(var t=0,n=this.effects.length;t<n;t++)this.effects[t]&&this.effects[t].loop(e)}}),Effect.Queues={instances:$H(),get:function(e){return Object.isString(e)?this.instances.get(e)||this.instances.set(e,new Effect.ScopedQueue):e}},Effect.Queue=Effect.Queues.get("global"),Effect.Base=Class.create({position:null,start:function(e){e&&e.transition===!1&&(e.transition=Effect.Transitions.linear),this.options=Object.extend(Object.extend({},Effect.DefaultOptions),e||{}),this.currentFrame=0,this.state="idle",this.startOn=this.options.delay*1e3,this.finishOn=this.startOn+this.options.duration*1e3,this.fromToDelta=this.options.to-this.options.from,this.totalTime=this.finishOn-this.startOn,this.totalFrames=this.options.fps*this.options.duration,this.render=function(){function e(e,t){e.options[t+"Internal"]&&e.options[t+"Internal"](e),e.options[t]&&e.options[t](e)}return function(t){this.state==="idle"&&(this.state="running",e(this,"beforeSetup"),this.setup&&this.setup(),e(this,"afterSetup")),this.state==="running"&&(t=this.options.transition(t)*this.fromToDelta+this.options.from,this.position=t,e(this,"beforeUpdate"),this.update&&this.update(t),e(this,"afterUpdate"))}}(),this.event("beforeStart"),this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)},loop:function(e){if(e>=this.startOn){if(e>=this.finishOn){this.render(1),this.cancel(),this.event("beforeFinish"),this.finish&&this.finish(),this.event("afterFinish");return}var t=(e-this.startOn)/this.totalTime,n=(t*this.totalFrames).round();n>this.currentFrame&&(this.render(t),this.currentFrame=n)}},cancel:function(){this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this),this.state="finished"},event:function(e){this.options[e+"Internal"]&&this.options[e+"Internal"](this),this.options[e]&&this.options[e](this)},inspect:function(){var e=$H();for(property in this)Object.isFunction(this[property])||e.set(property,this[property]);return"#<Effect:"+e.inspect()+",options:"+$H(this.options).inspect()+">"}}),Effect.Parallel=Class.create(Effect.Base,{initialize:function(e){this.effects=e||[],this.start(arguments[1])},update:function(e){this.effects.invoke("render",e)},finish:function(e){this.effects.each(function(t){t.render(1),t.cancel(),t.event("beforeFinish"),t.finish&&t.finish(e),t.event("afterFinish")})}}),Effect.Tween=Class.create(Effect.Base,{initialize:function(e,t,n){e=Object.isString(e)?$(e):e;var r=$A(arguments),i=r.last(),s=r.length==5?r[3]:null;this.method=Object.isFunction(i)?i.bind(e):Object.isFunction(e[i])?e[i].bind(e):function(t){e[i]=t},this.start(Object.extend({from:t,to:n},s||{}))},update:function(e){this.method(e)}}),Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction}),Effect.Opacity=Class.create(Effect.Base,{initialize:function(e){this.element=$(e);if(!this.element)throw Effect._elementDoesNotExistError;Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});var t=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(t)},update:function(e){this.element.setOpacity(e)}}),Effect.Move=Class.create(Effect.Base,{initialize:function(e){this.element=$(e);if(!this.element)throw Effect._elementDoesNotExistError;var t=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(t)},setup:function(){this.element.makePositioned(),this.originalLeft=parseFloat(this.element.getStyle("left")||"0"),this.originalTop=parseFloat(this.element.getStyle("top")||"0"),this.options.mode=="absolute"&&(this.options.x=this.options.x-this.originalLeft,this.options.y=this.options.y-this.originalTop)},update:function(e){this.element.setStyle({left:(this.options.x*e+this.originalLeft).round()+"px",top:(this.options.y*e+this.originalTop).round()+"px"})}}),Effect.MoveBy=function(e,t,n){return new Effect.Move(e,Object.extend({x:n,y:t},arguments[3]||{}))},Effect.Scale=Class.create(Effect.Base,{initialize:function(e,t){this.element=$(e);if(!this.element)throw Effect._elementDoesNotExistError;var n=Object.extend({scaleX:!0,scaleY:!0,scaleContent:!0,scaleFromCenter:!1,scaleMode:"box",scaleFrom:100,scaleTo:t},arguments[2]||{});this.start(n)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||!1,this.elementPositioning=this.element.getStyle("position"),this.originalStyle={},["top","left","width","height","fontSize"].each(function(e){this.originalStyle[e]=this.element.style[e]}.bind(this)),this.originalTop=this.element.offsetTop,this.originalLeft=this.element.offsetLeft;var e=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(t){e.indexOf(t)>0&&(this.fontSize=parseFloat(e),this.fontSizeType=t)}.bind(this)),this.factor=(this.options.scaleTo-this.options.scaleFrom)/100,this.dims=null,this.options.scaleMode=="box"&&(this.dims=[this.element.offsetHeight,this.element.offsetWidth]),/^content/.test(this.options.scaleMode)&&(this.dims=[this.element.scrollHeight,this.element.scrollWidth]),this.dims||(this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth])},update:function(e){var t=this.options.scaleFrom/100+this.factor*e;this.options.scaleContent&&this.fontSize&&this.element.setStyle({fontSize:this.fontSize*t+this.fontSizeType}),this.setDimensions(this.dims[0]*t,this.dims[1]*t)},finish:function(e){this.restoreAfterFinish&&this.element.setStyle(this.originalStyle)},setDimensions:function(e,t){var n={};this.options.scaleX&&(n.width=t.round()+"px"),this.options.scaleY&&(n.height=e.round()+"px");if(this.options.scaleFromCenter){var r=(e-this.dims[0])/2,i=(t-this.dims[1])/2;this.elementPositioning=="absolute"?(this.options.scaleY&&(n.top=this.originalTop-r+"px"),this.options.scaleX&&(n.left=this.originalLeft-i+"px")):(this.options.scaleY&&(n.top=-r+"px"),this.options.scaleX&&(n.left=-i+"px"))}this.element.setStyle(n)}}),Effect.Highlight=Class.create(Effect.Base,{initialize:function(e){this.element=$(e);if(!this.element)throw Effect._elementDoesNotExistError;var t=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(t)},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return}this.oldStyle={},this.options.keepBackgroundImage||(this.oldStyle.backgroundImage=this.element.getStyle("background-image"),this.element.setStyle({backgroundImage:"none"})),this.options.endcolor||(this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")),this.options.restorecolor||(this.options.restorecolor=this.element.getStyle("background-color")),this._base=$R(0,2).map(function(e){return parseInt(this.options.startcolor.slice(e*2+1,e*2+3),16)}.bind(this)),this._delta=$R(0,2).map(function(e){return parseInt(this.options.endcolor.slice(e*2+1,e*2+3),16)-this._base[e]}.bind(this))},update:function(e){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(t,n,r){return t+(this._base[r]+this._delta[r]*e).round().toColorPart()}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}}),Effect.ScrollTo=function(e){var t=arguments[1]||{},n=document.viewport.getScrollOffsets(),r=$(e).cumulativeOffset();return t.offset&&(r[1]+=t.offset),new Effect.Tween(null,n.top,r[1],t,function(e){scrollTo(n.left,e.round())})},Effect.Fade=function(e){e=$(e);var t=e.getInlineOpacity(),n=Object.extend({from:e.getOpacity()||1,to:0,afterFinishInternal:function(e){if(e.options.to!=0)return;e.element.hide().setStyle({opacity:t})}},arguments[1]||{});return new Effect.Opacity(e,n)},Effect.Appear=function(e){e=$(e);var t=Object.extend({from:e.getStyle("display")=="none"?0:e.getOpacity()||0,to:1,afterFinishInternal:function(e){e.element.forceRerendering()},beforeSetup:function(e){e.element.setOpacity(e.options.from).show()}},arguments[1]||{});return new Effect.Opacity(e,t)},Effect.Puff=function(e){e=$(e);var t={opacity:e.getInlineOpacity(),position:e.getStyle("position"),top:e.style.top,left:e.style.left,width:e.style.width,height:e.style.height};return new Effect.Parallel([new Effect.Scale(e,200,{sync:!0,scaleFromCenter:!0,scaleContent:!0,restoreAfterFinish:!0}),new Effect.Opacity(e,{sync:!0,to:0})],Object.extend({duration:1,beforeSetupInternal:function(e){Position.absolutize(e.effects[0].element)},afterFinishInternal:function(e){e.effects[0].element.hide().setStyle(t)}},arguments[1]||{}))},Effect.BlindUp=function(e){return e=$(e),e.makeClipping(),new Effect.Scale(e,0,Object.extend({scaleContent:!1,scaleX:!1,restoreAfterFinish:!0,afterFinishInternal:function(e){e.element.hide().undoClipping()}},arguments[1]||{}))},Effect.BlindDown=function(e){e=$(e);var t=e.getDimensions();return new Effect.Scale(e,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:0,scaleMode:{originalHeight:t.height,originalWidth:t.width},restoreAfterFinish:!0,afterSetup:function(e){e.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(e){e.element.undoClipping()}},arguments[1]||{}))},Effect.SwitchOff=function(e){e=$(e);var t=e.getInlineOpacity();return new Effect.Appear(e,Object.extend({duration:.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(e){new Effect.Scale(e.element,1,{duration:.3,scaleFromCenter:!0,scaleX:!1,scaleContent:!1,restoreAfterFinish:!0,beforeSetup:function(e){e.element.makePositioned().makeClipping()},afterFinishInternal:function(e){e.element.hide().undoClipping().undoPositioned().setStyle({opacity:t})}})}},arguments[1]||{}))},Effect.DropOut=function(e){e=$(e);var t={top:e.getStyle("top"),left:e.getStyle("left"),opacity:e.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(e,{x:0,y:100,sync:!0}),new Effect.Opacity(e,{sync:!0,to:0})],Object.extend({duration:.5,beforeSetup:function(e){e.effects[0].element.makePositioned()},afterFinishInternal:function(e){e.effects[0].element.hide().undoPositioned().setStyle(t)}},arguments[1]||{}))},Effect.Shake=function(e){e=$(e);var t=Object.extend({distance:20,duration:.5},arguments[1]||{}),n=parseFloat(t.distance),r=parseFloat(t.duration)/10,i={top:e.getStyle("top"),left:e.getStyle("left")};return new Effect.Move(e,{x:n,y:0,duration:r,afterFinishInternal:function(e){new Effect.Move(e.element,{x:-n*2,y:0,duration:r*2,afterFinishInternal:function(e){new Effect.Move(e.element,{x:n*2,y:0,duration:r*2,afterFinishInternal:function(e){new Effect.Move(e.element,{x:-n*2,y:0,duration:r*2,afterFinishInternal:function(e){new Effect.Move(e.element,{x:n*2,y:0,duration:r*2,afterFinishInternal:function(e){new Effect.Move(e.element,{x:-n,y:0,duration:r,afterFinishInternal:function(e){e.element.undoPositioned().setStyle(i)}})}})}})}})}})}})},Effect.SlideDown=function(e){e=$(e).cleanWhitespace();var t=e.down().getStyle("bottom"),n=e.getDimensions();return new Effect.Scale(e,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:n.height,originalWidth:n.width},restoreAfterFinish:!0,afterSetup:function(e){e.element.makePositioned(),e.element.down().makePositioned(),window.opera&&e.element.setStyle({top:""}),e.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(e){e.element.down().setStyle({bottom:e.dims[0]-e.element.clientHeight+"px"})},afterFinishInternal:function(e){e.element.undoClipping().undoPositioned(),e.element.down().undoPositioned().setStyle({bottom:t})}},arguments[1]||{}))},Effect.SlideUp=function(e){e=$(e).cleanWhitespace();var t=e.down().getStyle("bottom"),n=e.getDimensions();return new Effect.Scale(e,window.opera?0:1,Object.extend({scaleContent:!1,scaleX:!1,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:n.height,originalWidth:n.width},restoreAfterFinish:!0,afterSetup:function(e){e.element.makePositioned(),e.element.down().makePositioned(),window.opera&&e.element.setStyle({top:""}),e.element.makeClipping().show()},afterUpdateInternal:function(e){e.element.down().setStyle({bottom:e.dims[0]-e.element.clientHeight+"px"})},afterFinishInternal:function(e){e.element.hide().undoClipping().undoPositioned(),e.element.down().undoPositioned().setStyle({bottom:t})}},arguments[1]||{}))},Effect.Squish=function(e){return new Effect.Scale(e,window.opera?1:0,{restoreAfterFinish:!0,beforeSetup:function(e){e.element.makeClipping()},afterFinishInternal:function(e){e.element.hide().undoClipping()}})},Effect.Grow=function(e){e=$(e);var t=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{}),n={top:e.style.top,left:e.style.left,height:e.style.height,width:e.style.width,opacity:e.getInlineOpacity()},r=e.getDimensions(),i,s,o,u;switch(t.direction){case"top-left":i=s=o=u=0;break;case"top-right":i=r.width,s=u=0,o=-r.width;break;case"bottom-left":i=o=0,s=r.height,u=-r.height;break;case"bottom-right":i=r.width,s=r.height,o=-r.width,u=-r.height;break;case"center":i=r.width/2,s=r.height/2,o=-r.width/2,u=-r.height/2}return new Effect.Move(e,{x:i,y:s,duration:.01,beforeSetup:function(e){e.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(e){new Effect.Parallel([new Effect.Opacity(e.element,{sync:!0,to:1,from:0,transition:t.opacityTransition}),new Effect.Move(e.element,{x:o,y:u,sync:!0,transition:t.moveTransition}),new Effect.Scale(e.element,100,{scaleMode:{originalHeight:r.height,originalWidth:r.width},sync:!0,scaleFrom:window.opera?1:0,transition:t.scaleTransition,restoreAfterFinish:!0})],Object.extend({beforeSetup:function(e){e.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(e){e.effects[0].element.undoClipping().undoPositioned().setStyle(n)}},t))}})},Effect.Shrink=function(e){e=$(e);var t=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{}),n={top:e.style.top,left:e.style.left,height:e.style.height,width:e.style.width,opacity:e.getInlineOpacity()},r=e.getDimensions(),i,s;switch(t.direction){case"top-left":i=s=0;break;case"top-right":i=r.width,s=0;break;case"bottom-left":i=0,s=r.height;break;case"bottom-right":i=r.width,s=r.height;break;case"center":i=r.width/2,s=r.height/2}return new Effect.Parallel([new Effect.Opacity(e,{sync:!0,to:0,from:1,transition:t.opacityTransition}),new Effect.Scale(e,window.opera?1:0,{sync:!0,transition:t.scaleTransition,restoreAfterFinish:!0}),new Effect.Move(e,{x:i,y:s,sync:!0,transition:t.moveTransition})],Object.extend({beforeStartInternal:function(e){e.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(e){e.effects[0].element.hide().undoClipping().undoPositioned().setStyle(n)}},t))},Effect.Pulsate=function(e){e=$(e);var t=arguments[1]||{},n=e.getInlineOpacity(),r=t.transition||Effect.Transitions.linear,i=function(e){return 1-r(-Math.cos(e*(t.pulses||5)*2*Math.PI)/2+.5)};return new Effect.Opacity(e,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(e){e.element.setStyle({opacity:n})}},t),{transition:i}))},Effect.Fold=function(e){e=$(e);var t={top:e.style.top,left:e.style.left,width:e.style.width,height:e.style.height};return e.makeClipping(),new Effect.Scale(e,5,Object.extend({scaleContent:!1,scaleX:!1,afterFinishInternal:function(n){new Effect.Scale(e,1,{scaleContent:!1,scaleY:!1,afterFinishInternal:function(e){e.element.hide().undoClipping().setStyle(t)}})}},arguments[1]||{}))},Effect.Morph=Class.create(Effect.Base,{initialize:function(e){this.element=$(e);if(!this.element)throw Effect._elementDoesNotExistError;var t=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(t.style))this.style=$H(t.style);else if(t.style.include(":"))this.style=t.style.parseStyle();else{this.element.addClassName(t.style),this.style=$H(this.element.getStyles()),this.element.removeClassName(t.style);var n=this.element.getStyles();this.style=this.style.reject(function(e){return e.value==n[e.key]}),t.afterFinishInternal=function(e){e.element.addClassName(e.options.style),e.transforms.each(function(t){e.element.style[t.style]=""})}}this.start(t)},setup:function(){function e(e){if(!e||["rgba(0, 0, 0, 0)","transparent"].include(e))e="#ffffff";return e=e.parseColor(),$R(0,2).map(function(t){return parseInt(e.slice(t*2+1,t*2+3),16)})}this.transforms=this.style.map(function(t){var n=t[0],r=t[1],i=null;if(r.parseColor("#zzzzzz")!="#zzzzzz")r=r.parseColor(),i="color";else if(n=="opacity")r=parseFloat(r),Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});else if(Element.CSS_LENGTH.test(r)){var s=r.match(/^([\+\-]?[0-9\.]+)(.*)$/);r=parseFloat(s[1]),i=s.length==3?s[2]:null}var o=this.element.getStyle(n);return{style:n.camelize(),originalValue:i=="color"?e(o):parseFloat(o||0),targetValue:i=="color"?e(r):r,unit:i}}.bind(this)).reject(function(e){return e.originalValue==e.targetValue||e.unit!="color"&&(isNaN(e.originalValue)||isNaN(e.targetValue))})},update:function(e){var t={},n,r=this.transforms.length;while(r--)t[(n=this.transforms[r]).style]=n.unit=="color"?"#"+Math.round(n.originalValue[0]+(n.targetValue[0]-n.originalValue[0])*e).toColorPart()+Math.round(n.originalValue[1]+(n.targetValue[1]-n.originalValue[1])*e).toColorPart()+Math.round(n.originalValue[2]+(n.targetValue[2]-n.originalValue[2])*e).toColorPart():(n.originalValue+(n.targetValue-n.originalValue)*e).toFixed(3)+(n.unit===null?"":n.unit);this.element.setStyle(t,!0)}}),Effect.Transform=Class.create({initialize:function(e){this.tracks=[],this.options=arguments[1]||{},this.addTracks(e)},addTracks:function(e){return e.each(function(e){e=$H(e);var t=e.values().first();this.tracks.push($H({ids:e.keys().first(),effect:Effect.Morph,options:{style:t}}))}.bind(this)),this},play:function(){return new Effect.Parallel(this.tracks.map(function(e){var t=e.get("ids"),n=e.get("effect"),r=e.get("options"),i=[$(t)||$$(t)].flatten();return i.map(function(e){return new n(e,Object.extend({sync:!0},r))})}).flatten(),this.options)}}),Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex"),Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/,String.__parseStyleElement=document.createElement("div"),String.prototype.parseStyle=function(){var e,t=$H();return Prototype.Browser.WebKit?e=(new Element("div",{style:this})).style:(String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>',e=String.__parseStyleElement.childNodes[0].style),Element.CSS_PROPERTIES.each(function(n){e[n]&&t.set(n,e[n])}),Prototype.Browser.IE&&this.include("opacity")&&t.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]),t},document.defaultView&&document.defaultView.getComputedStyle?Element.getStyles=function(e){var t=document.defaultView.getComputedStyle($(e),null);return Element.CSS_PROPERTIES.inject({},function(e,n){return e[n]=t[n],e})}:Element.getStyles=function(e){e=$(e);var t=e.currentStyle,n;return n=Element.CSS_PROPERTIES.inject({},function(e,n){return e[n]=t[n],e}),n.opacity||(n.opacity=e.getOpacity()),n},Effect.Methods={morph:function(e,t){return e=$(e),new Effect.Morph(e,Object.extend({style:t},arguments[2]||{})),e},visualEffect:function(e,t,n){e=$(e);var r=t.dasherize().camelize(),i=r.charAt(0).toUpperCase()+r.substring(1);return new Effect[i](e,n),e},highlight:function(e,t){return e=$(e),new Effect.Highlight(e,t),e}},$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(e){Effect.Methods[e]=function(t,n){return t=$(t),Effect[e.charAt(0).toUpperCase()+e.substring(1)](t,n),t}}),$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(e){Effect.Methods[e]=Element[e]}),Element.addMethods(Effect.Methods);if(Object.isUndefined(Effect))throw"dragdrop.js requires including script.aculo.us' effects.js library";var Droppables={drops:[],remove:function(e){this.drops=this.drops.reject(function(t){return t.element==$(e)})},add:function(e){e=$(e);var t=Object.extend({greedy:!0,hoverclass:null,tree:!1},arguments[1]||{});if(t.containment){t._containers=[];var n=t.containment;Object.isArray(n)?n.each(function(e){t._containers.push($(e))}):t._containers.push($(n))}t.accept&&(t.accept=[t.accept].flatten()),Element.makePositioned(e),t.element=e,this.drops.push(t)},findDeepestChild:function(e){deepest=e[0];for(i=1;i<e.length;++i)Element.isParent(e[i].element,deepest.element)&&(deepest=e[i]);return deepest},isContained:function(e,t){var n;return t.tree?n=e.treeNode:n=e.parentNode,t._containers.detect(function(e){return n==e})},isAffected:function(e,t,n){return n.element!=t&&(!n._containers||this.isContained(t,n))&&(!n.accept||Element.classNames(t).detect(function(e){return n.accept.include(e)}))&&Position.within(n.element,e[0],e[1])},deactivate:function(e){e.hoverclass&&Element.removeClassName(e.element,e.hoverclass),this.last_active=null},activate:function(e){e.hoverclass&&Element.addClassName(e.element,e.hoverclass),this.last_active=e},show:function(e,t){if(!this.drops.length)return;var n,r=[];this.drops.each(function(n){Droppables.isAffected(e,t,n)&&r.push(n)}),r.length>0&&(n=Droppables.findDeepestChild(r)),this.last_active&&this.last_active!=n&&this.deactivate(this.last_active),n&&(Position.within(n.element,e[0],e[1]),n.onHover&&n.onHover(t,n.element,Position.overlap(n.overlap,n.element)),n!=this.last_active&&Droppables.activate(n))},fire:function(e,t){if(!this.last_active)return;Position.prepare();if(this.isAffected([Event.pointerX(e),Event.pointerY(e)],t,this.last_active)&&this.last_active.onDrop)return this.last_active.onDrop(t,this.last_active.element,e),!0},reset:function(){this.last_active&&this.deactivate(this.last_active)}},Draggables={drags:[],observers:[],register:function(e){this.drags.length==0&&(this.eventMouseUp=this.endDrag.bindAsEventListener(this),this.eventMouseMove=this.updateDrag.bindAsEventListener(this),this.eventKeypress=this.keyPress.bindAsEventListener(this),Event.observe(document,"mouseup",this.eventMouseUp),Event.observe(document,"mousemove",this.eventMouseMove),Event.observe(document,"keypress",this.eventKeypress)),this.drags.push(e)},unregister:function(e){this.drags=this.drags.reject(function(t){return t==e}),this.drags.length==0&&(Event.stopObserving(document,"mouseup",this.eventMouseUp),Event.stopObserving(document,"mousemove",this.eventMouseMove),Event.stopObserving(document,"keypress",this.eventKeypress))},activate:function(e){e.options.delay?this._timeout=setTimeout(function(){Draggables._timeout=null,window.focus(),Draggables.activeDraggable=e}.bind(this),e.options.delay):(window.focus(),this.activeDraggable=e)},deactivate:function(){this.activeDraggable=null},updateDrag:function(e){if(!this.activeDraggable)return;var t=[Event.pointerX(e),Event.pointerY(e)];if(this._lastPointer&&this._lastPointer.inspect()==t.inspect())return;this._lastPointer=t,this.activeDraggable.updateDrag(e,t)},endDrag:function(e){this._timeout&&(clearTimeout(this._timeout),this._timeout=null);if(!this.activeDraggable)return;this._lastPointer=null,this.activeDraggable.endDrag(e),this.activeDraggable=null},keyPress:function(e){this.activeDraggable&&this.activeDraggable.keyPress(e)},addObserver:function(e){this.observers.push(e),this._cacheObserverCallbacks()},removeObserver:function(e){this.observers=this.observers.reject(function(t){return t.element==e}),this._cacheObserverCallbacks()},notify:function(e,t,n){this[e+"Count"]>0&&this.observers.each(function(r){r[e]&&r[e](e,t,n)}),t.options[e]&&t.options[e](t,n)},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(e){Draggables[e+"Count"]=Draggables.observers.select(function(t){return t[e]}).length})}},Draggable=Class.create({initialize:function(e){var t={handle:!1,reverteffect:function(e,t,n){var r=Math.sqrt(Math.abs(t^2)+Math.abs(n^2))*.02;new Effect.Move(e,{x:-n,y:-t,duration:r,queue:{scope:"_draggable",position:"end"}})},endeffect:function(e){var t=Object.isNumber(e._opacity)?e._opacity:1;new Effect.Opacity(e,{duration:.2,from:.7,to:t,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[e]=!1}})},zindex:1e3,revert:!1,quiet:!1,scroll:!1,scrollSensitivity:20,scrollSpeed:15,snap:!1,delay:0};(!arguments[1]||Object.isUndefined(arguments[1].endeffect))&&Object.extend(t,{starteffect:function(e){e._opacity=Element.getOpacity(e),Draggable._dragging[e]=!0,new Effect.Opacity(e,{duration:.2,from:e._opacity,to:.7})}});var n=Object.extend(t,arguments[1]||{});this.element=$(e),n.handle&&Object.isString(n.handle)&&(this.handle=this.element.down("."+n.handle,0)),this.handle||(this.handle=$(n.handle)),this.handle||(this.handle=this.element),n.scroll&&!n.scroll.scrollTo&&!n.scroll.outerHTML&&(n.scroll=$(n.scroll),this._isScrollChild=Element.childOf(this.element,n.scroll)),Element.makePositioned(this.element),this.options=n,this.dragging=!1,this.eventMouseDown=this.initDrag.bindAsEventListener(this),Event.observe(this.handle,"mousedown",this.eventMouseDown),Draggables.register(this)},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown),Draggables.unregister(this)},currentDelta:function(){return[parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")]},initDrag:function(e){if(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element])return;if(Event.isLeftClick(e)){var t=Event.element(e);if(!(!(tag_name=t.tagName.toUpperCase())||tag_name!="INPUT"&&tag_name!="SELECT"&&tag_name!="OPTION"&&tag_name!="BUTTON"&&tag_name!="TEXTAREA"))return;var n=[Event.pointerX(e),Event.pointerY(e)],r=this.element.cumulativeOffset();this.offset=[0,1].map(function(e){return n[e]-r[e]}),Draggables.activate(this),Event.stop(e)}},startDrag:function(e){this.dragging=!0,this.delta||(this.delta=this.currentDelta()),this.options.zindex&&(this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0),this.element.style.zIndex=this.options.zindex),this.options.ghosting&&(this._clone=this.element.cloneNode(!0),this._originallyAbsolute=this.element.getStyle("position")=="absolute",this._originallyAbsolute||Position.absolutize(this.element),this.element.parentNode.insertBefore(this._clone,this.element));if(this.options.scroll)if(this.options.scroll==window){var t=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=t.left,this.originalScrollTop=t.top}else this.originalScrollLeft=this.options.scroll.scrollLeft,this.originalScrollTop=this.options.scroll.scrollTop;Draggables.notify("onStart",this,e),this.options.starteffect&&this.options.starteffect(this.element)},updateDrag:function(event,pointer){this.dragging||this.startDrag(event),this.options.quiet||(Position.prepare(),Droppables.show(pointer,this.element)),Draggables.notify("onDrag",this,event),this.draw(pointer),this.options.change&&this.options.change(this);if(this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll))p=[left,top,left+width,top+height];else p=Position.page(this.options.scroll).toArray(),p[0]+=this.options.scroll.scrollLeft+Position.deltaX,p[1]+=this.options.scroll.scrollTop+Position.deltaY,p.push(p[0]+this.options.scroll.offsetWidth),p.push(p[1]+this.options.scroll.offsetHeight);var speed=[0,0];pointer[0]<p[0]+this.options.scrollSensitivity&&(speed[0]=pointer[0]-(p[0]+this.options.scrollSensitivity)),pointer[1]<p[1]+this.options.scrollSensitivity&&(speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity)),pointer[0]>p[2]-this.options.scrollSensitivity&&(speed[0]=pointer[0]-(p[2]-this.options.scrollSensitivity)),pointer[1]>p[3]-this.options.scrollSensitivity&&(speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity)),this.startScrolling(speed)}Prototype.Browser.WebKit&&window.scrollBy(0,0),Event.stop(event)},finishDrag:function(e,t){this.dragging=!1;if(this.options.quiet){Position.prepare();var n=[Event.pointerX(e),Event.pointerY(e)];Droppables.show(n,this.element)}this.options.ghosting&&(this._originallyAbsolute||Position.relativize(this.element),delete this._originallyAbsolute,Element.remove(this._clone),this._clone=null);var r=!1;t&&(r=Droppables.fire(e,this.element),r||(r=!1)),r&&this.options.onDropped&&this.options.onDropped(this.element),Draggables.notify("onEnd",this,e);var i=this.options.revert;i&&Object.isFunction(i)&&(i=i(this.element));var s=this.currentDelta();i&&this.options.reverteffect?(r==0||i!="failure")&&this.options.reverteffect(this.element,s[1]-this.delta[1],s[0]-this.delta[0]):this.delta=s,this.options.zindex&&(this.element.style.zIndex=this.originalZ),this.options.endeffect&&this.options.endeffect(this.element),Draggables.deactivate(this),Droppables.reset()},keyPress:function(e){if(e.keyCode!=Event.KEY_ESC)return;this.finishDrag(e,!1),Event.stop(e)},endDrag:function(e){if(!this.dragging)return;this.stopScrolling(),this.finishDrag(e,!0),Event.stop(e)},draw:function(e){var t=this.element.cumulativeOffset();if(this.options.ghosting){var n=Position.realOffset(this.element);t[0]+=n[0]-Position.deltaX,t[1]+=n[1]-Position.deltaY}var r=this.currentDelta();t[0]-=r[0],t[1]-=r[1],this.options.scroll&&this.options.scroll!=window&&this._isScrollChild&&(t[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft,t[1]-=this.options.scroll.scrollTop-this.originalScrollTop);var i=[0,1].map(function(n){return e[n]-t[n]-this.offset[n]}.bind(this));this.options.snap&&(Object.isFunction(this.options.snap)?i=this.options.snap(i[0],i[1],this):Object.isArray(this.options.snap)?i=i.map(function(e,t){return(e/this.options.snap[t]).round()*this.options.snap[t]}.bind(this)):i=i.map(function(e){return(e/this.options.snap).round()*this.options.snap}.bind(this)));var s=this.element.style;if(!this.options.constraint||this.options.constraint=="horizontal")s.left=i[0]+"px";if(!this.options.constraint||this.options.constraint=="vertical")s.top=i[1]+"px";s.visibility=="hidden"&&(s.visibility="")},stopScrolling:function(){this.scrollInterval&&(clearInterval(this.scrollInterval),this.scrollInterval=null,Draggables._lastScrollPointer=null)},startScrolling:function(e){if(!e[0]&&!e[1])return;this.scrollSpeed=[e[0]*this.options.scrollSpeed,e[1]*this.options.scrollSpeed],this.lastScrolled=new Date,this.scrollInterval=setInterval(this.scroll.bind(this),10)},scroll:function(){var current=new Date,delta=current-this.lastScrolled;this.lastScrolled=current;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll))if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1e3;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1])}else this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1e3,this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1e3;Position.prepare(),Droppables.show(Draggables._lastPointer,this.element),Draggables.notify("onDrag",this),this._isScrollChild&&(Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer),Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1e3,Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1e3,Draggables._lastScrollPointer[0]<0&&(Draggables._lastScrollPointer[0]=0),Draggables._lastScrollPointer[1]<0&&(Draggables._lastScrollPointer[1]=0),this.draw(Draggables._lastScrollPointer)),this.options.change&&this.options.change(this)},_getWindowScroll:function(w){var T,L,W,H;with(w.document)w.document.documentElement&&documentElement.scrollTop?(T=documentElement.scrollTop,L=documentElement.scrollLeft):w.document.body&&(T=body.scrollTop,L=body.scrollLeft),w.innerWidth?(W=w.innerWidth,H=w.innerHeight):w.document.documentElement&&documentElement.clientWidth?(W=documentElement.clientWidth,H=documentElement.clientHeight):(W=body.offsetWidth,H=body.offsetHeight);return{top:T,left:L,width:W,height:H}}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(e,t){this.element=$(e),this.observer=t,this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(){Sortable.unmark(),this.lastValue!=Sortable.serialize(this.element)&&this.observer(this.element)}}),Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(e){while(e.tagName.toUpperCase()!="BODY"){if(e.id&&Sortable.sortables[e.id])return e;e=e.parentNode}},options:function(e){e=Sortable._findRootElement($(e));if(!e)return;return Sortable.sortables[e.id]},destroy:function(e){e=$(e);var t=Sortable.sortables[e.id];t&&(Draggables.removeObserver(t.element),t.droppables.each(function(e){Droppables.remove(e)}),t.draggables.invoke("destroy"),delete Sortable.sortables[t.element.id])},create:function(e){e=$(e);var t=Object.extend({element:e,tag:"li",dropOnEmpty:!1,tree:!1,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:e,handle:!1,only:!1,delay:0,hoverclass:null,ghosting:!1,quiet:!1,scroll:!1,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:!1,handles:!1,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(e);var n={revert:!0,quiet:t.quiet,scroll:t.scroll,scrollSpeed:t.scrollSpeed,scrollSensitivity:t.scrollSensitivity,delay:t.delay,ghosting:t.ghosting,constraint:t.constraint,handle:t.handle};t.starteffect&&(n.starteffect=t.starteffect),t.reverteffect?n.reverteffect=t.reverteffect:t.ghosting&&(n.reverteffect=function(e){e.style.top=0,e.style.left=0}),t.endeffect&&(n.endeffect=t.endeffect),t.zindex&&(n.zindex=t.zindex);var r={overlap:t.overlap,containment:t.containment,tree:t.tree,hoverclass:t.hoverclass,onHover:Sortable.onHover},i={onHover:Sortable.onEmptyHover,overlap:t.overlap,containment:t.containment,hoverclass:t.hoverclass};Element.cleanWhitespace(e),t.draggables=[],t.droppables=[];if(t.dropOnEmpty||t.tree)Droppables.add(e,i),t.droppables.push(e);(t.elements||this.findElements(e,t)||[]).each(function(i,s){var o=t.handles?$(t.handles[s]):t.handle?$(i).select("."+t.handle)[0]:i;t.draggables.push(new Draggable(i,Object.extend(n,{handle:o}))),Droppables.add(i,r),t.tree&&(i.treeNode=e),t.droppables.push(i)}),t.tree&&(Sortable.findTreeElements(e,t)||[]).each(function(n){Droppables.add(n,i),n.treeNode=e,t.droppables.push(n)}),this.sortables[e.identify()]=t,Draggables.addObserver(new SortableObserver(e,t.onUpdate))},findElements:function(e,t){return Element.findChildren(e,t.only,t.tree?!0:!1,t.tag)},findTreeElements:function(e,t){return Element.findChildren(e,t.only,t.tree?!0:!1,t.treeTag)},onHover:function(e,t,n){if(Element.isParent(t,e))return;if(n>.33&&n<.66&&Sortable.options(t).tree)return;if(n>.5){Sortable.mark(t,"before");if(t.previousSibling!=e){var r=e.parentNode;e.style.visibility="hidden",t.parentNode.insertBefore(e,t),t.parentNode!=r&&Sortable.options(r).onChange(e),Sortable.options(t.parentNode).onChange(e)}}else{Sortable.mark(t,"after");var i=t.nextSibling||null;if(i!=e){var r=e.parentNode;e.style.visibility="hidden",t.parentNode.insertBefore(e,i),t.parentNode!=r&&Sortable.options(r).onChange(e),Sortable.options(t.parentNode).onChange(e)}}},onEmptyHover:function(e,t,n){var r=e.parentNode,i=Sortable.options(t);if(!Element.isParent(t,e)){var s,o=Sortable.findElements(t,{tag:i.tag,only:i.only}),u=null;if(o){var a=Element.offsetSize(t,i.overlap)*(1-n);for(s=0;s<o.length;s+=1){if(!(a-Element.offsetSize(o[s],i.overlap)>=0)){if(a-Element.offsetSize(o[s],i.overlap)/2>=0){u=s+1<o.length?o[s+1]:null;break}u=o[s];break}a-=Element.offsetSize(o[s],i.overlap)}}t.insertBefore(e,u),Sortable.options(r).onChange(e),i.onChange(e)}},unmark:function(){Sortable._marker&&Sortable._marker.hide()},mark:function(e,t){var n=Sortable.options(e.parentNode);if(n&&!n.ghosting)return;Sortable._marker||(Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"}),document.getElementsByTagName("body").item(0).appendChild(Sortable._marker));var r=e.cumulativeOffset();Sortable._marker.setStyle({left:r[0]+"px",top:r[1]+"px"}),t=="after"&&(n.overlap=="horizontal"?Sortable._marker.setStyle({left:r[0]+e.clientWidth+"px"}):Sortable._marker.setStyle({top:r[1]+e.clientHeight+"px"})),Sortable._marker.show()},_tree:function(e,t,n){var r=Sortable.findElements(e,t)||[];for(var i=0;i<r.length;++i){var s=r[i].id.match(t.format);if(!s)continue;var o={id:encodeURIComponent(s?s[1]:null),element:e,parent:n,children:[],position:n.children.length,container:$(r[i]).down(t.treeTag)};o.container&&this._tree(o.container,t,o),n.children.push(o)}return n},tree:function(e){e=$(e);var t=this.options(e),n=Object.extend({tag:t.tag,treeTag:t.treeTag,only:t.only,name:e.id,format:t.format},arguments[1]||{}),r={id:null,parent:null,children:[],container:e,position:0};return Sortable._tree(e,n,r)},_constructIndex:function(e){var t="";do e.id&&(t="["+e.position+"]"+t);while((e=e.parent)!=null);return t},sequence:function(e){e=$(e);var t=Object.extend(this.options(e),arguments[1]||{});return $(this.findElements(e,t)||[]).map(function(e){return e.id.match(t.format)?e.id.match(t.format)[1]:""})},setSequence:function(e,t){e=$(e);var n=Object.extend(this.options(e),arguments[2]||{}),r={};this.findElements(e,n).each(function(e){e.id.match(n.format)&&(r[e.id.match(n.format)[1]]=[e,e.parentNode]),e.parentNode.removeChild(e)}),t.each(function(e){var t=r[e];t&&(t[1].appendChild(t[0]),delete r[e])})},serialize:function(e){e=$(e);var t=Object.extend(Sortable.options(e),arguments[1]||{}),n=encodeURIComponent(arguments[1]&&arguments[1].name?arguments[1].name:e.id);return t.tree?Sortable.tree(e,arguments[1]).children.map(function(e){return[n+Sortable._constructIndex(e)+"[id]="+encodeURIComponent(e.id)].concat(e.children.map(arguments.callee))}).flatten().join("&"):Sortable.sequence(e,arguments[1]).map(function(e){return n+"[]="+encodeURIComponent(e)}).join("&")}};Element.isParent=function(e,t){return!e.parentNode||e==t?!1:e.parentNode==t?!0:Element.isParent(e.parentNode,t)},Element.findChildren=function(e,t,n,r){if(!e.hasChildNodes())return null;r=r.toUpperCase(),t&&(t=[t].flatten());var i=[];return $A(e.childNodes).each(function(e){e.tagName&&e.tagName.toUpperCase()==r&&(!t||Element.classNames(e).detect(function(e){return t.include(e)}))&&i.push(e);if(n){var s=Element.findChildren(e,t,n,r);s&&i.push(s)}}),i.length>0?i.flatten():[]},Element.offsetSize=function(e,t){return e["offset"+(t=="vertical"||t=="height"?"Height":"Width")]};