var JSON;JSON||(JSON={}),function(){"use strict";function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,n,s,a,o,l=gap,r=t[e];switch(r&&"object"==typeof r&&"function"==typeof r.toJSON&&(r=r.toJSON(e)),"function"==typeof rep&&(r=rep.call(t,e,r)),typeof r){case"string":return quote(r);case"number":return isFinite(r)?r+"":"null";case"boolean":case"null":return r+"";case"object":if(!r)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(r)){for(a=r.length,i=0;a>i;i+=1)o[i]=str(i,r)||"null";return s=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+l+"]":"["+o.join(",")+"]",gap=l,s}if(rep&&"object"==typeof rep)for(a=rep.length,i=0;a>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],s=str(n,r),s&&o.push(quote(n)+(gap?": ":":")+s));else for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(s=str(n,r),s&&o.push(quote(n)+(gap?": ":":")+s));return s=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+l+"}":"{"+o.join(",")+"}",gap=l,s}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var i,n,s=e[t];if(s&&"object"==typeof s)for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(n=walk(s,i),void 0!==n?s[i]=n:delete s[i]);return reviver.call(e,t,s)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var TableKit=Class.create();TableKit.prototype={initialize:function(e,t){var i=$(e);if("TABLE"===i.tagName){TableKit.register(i,Object.extend(TableKit.options,t||{})),this.id=i.id;var n=TableKit.option("sortable resizable editable",this.id);n.sortable&&TableKit.Sortable.init(i),n.resizable&&TableKit.Resizable.init(i),n.editable&&TableKit.Editable.init(i)}},sort:function(e,t){TableKit.Sortable.sort(this.id,e,t)},resizeColumn:function(e,t){TableKit.Resizable.resize(this.id,e,t)},editCell:function(e,t){TableKit.Editable.editCell(this.id,e,t)}},Object.extend(TableKit,{getBodyRows:function(e){e=$(e);var t=e.id;return TableKit.tables[t].dom.rows||(TableKit.tables[t].dom.rows=e.tHead&&e.tHead.rows.length>0?$A(e.tBodies[0].rows):$A(e.rows).without(e.rows[0])),TableKit.tables[t].dom.rows},getHeaderCells:function(e,t){e||(e=$(t).up("table"));var i=e.id;return TableKit.tables[i].dom.head||(TableKit.tables[i].dom.head=$A(e.tHead&&e.tHead.rows.length>0?e.tHead.rows[e.tHead.rows.length-1].cells:e.rows[0].cells)),TableKit.tables[i].dom.head},getCellIndex:function(e){return $A(e.parentNode.cells).indexOf(e)},getRowIndex:function(e){return $A(e.parentNode.rows).indexOf(e)},getCellText:function(e,t){if(!e)return"";var i=TableKit.getCellData(e);return(t||i.refresh||!i.textContent)&&(i.textContent=e.textContent?e.textContent:e.innerText,i.refresh=!1),i.textContent},getCellData:function(e){var t=null;e.id||(t=$(e).up("table"),e.id=t.id+"-cell-"+TableKit._getc());var i=t?t.id:e.id.match(/(.*)-cell.*/)[1];return TableKit.tables[i].dom.cells[e.id]||(TableKit.tables[i].dom.cells[e.id]={textContent:"",htmlContent:"",active:!1}),TableKit.tables[i].dom.cells[e.id]},register:function(e,t){e.id||(e.id="tablekit-table-"+TableKit._getc());var i=e.id;TableKit.tables[i]=TableKit.tables[i]?Object.extend(TableKit.tables[i],t||{}):Object.extend({dom:{head:null,rows:null,cells:{}},sortable:!1,resizable:!1,editable:!1},t||{})},notify:function(e,t,i){TableKit.tables[t.id]&&TableKit.tables[t.id].observers&&TableKit.tables[t.id].observers[e]&&TableKit.tables[t.id].observers[e](t,i),TableKit.options.observers[e](t,i)()},isSortable:function(e){return TableKit.tables[e.id]?TableKit.tables[e.id].sortable:!1},isResizable:function(e){return TableKit.tables[e.id]?TableKit.tables[e.id].resizable:!1},isEditable:function(e){return TableKit.tables[e.id]?TableKit.tables[e.id].editable:!1},setup:function(e){Object.extend(TableKit.options,e||{})},option:function(e,t,i,n){i=i||TableKit.options,n=n||(t?TableKit.tables[t]?TableKit.tables[t]:{}:{});var s=t+e;return TableKit._opcache[s]||(TableKit._opcache[s]=$A($w(e)).inject([],function(e,t){return e.push(e[t]=n[t]||i[t]),e})),TableKit._opcache[s]},e:function(e){return e||window.event},tables:{},_opcache:{},options:{autoLoad:!0,stripe:!0,sortable:!0,resizable:!0,editable:!0,rowEvenClass:"roweven",rowOddClass:"rowodd",sortableSelector:["table.sortable"],columnClass:"sortcol",descendingClass:"sortdesc",ascendingClass:"sortasc",defaultSortDirection:1,noSortClass:"nosort",sortFirstAscendingClass:"sortfirstasc",sortFirstDecendingClass:"sortfirstdesc",resizableSelector:["table.resizable"],minWidth:10,showHandle:!0,resizeOnHandleClass:"resize-handle-active",editableSelector:["table.editable"],formClassName:"editable-cell-form",noEditClass:"noedit",editAjaxURI:"/",editAjaxOptions:{},observers:{onSortStart:function(){},onSort:function(){},onSortEnd:function(){},onResizeStart:function(){},onResize:function(){},onResizeEnd:function(){},onEditStart:function(){},onEdit:function(){},onEditEnd:function(){}}},_c:0,_getc:function(){return TableKit._c+=1},unloadTable:function(e){if(e=$(e),TableKit.tables[e.id]){var t=TableKit.getHeaderCells(e),i=TableKit.option("sortable resizable editable noSortClass descendingClass ascendingClass columnClass sortFirstAscendingClass sortFirstDecendingClass",e.id);if(t.each(function(e){e=$(e),i.sortable&&(e.hasClassName(i.noSortClass)||(Event.stopObserving(e,"mousedown",TableKit.Sortable._sort),e.removeClassName(i.columnClass),e.removeClassName(i.sortFirstAscendingClass),e.removeClassName(i.sortFirstDecendingClass),e.hasClassName(i.ascendingClass)?(e.removeClassName(i.ascendingClass),e.addClassName(i.sortFirstAscendingClass)):e.hasClassName(i.descendingClass)&&(e.removeClassName(i.descendingClass),e.addClassName(i.sortFirstDecendingClass)))),i.resizable&&(Event.stopObserving(e,"mouseover",TableKit.Resizable.initDetect),Event.stopObserving(e,"mouseout",TableKit.Resizable.killDetect))}),i.editable){Event.stopObserving(e.tBodies[0],"click",TableKit.Editable._editCell);for(var n in TableKit.tables[e.id].dom.cells)if(TableKit.tables[e.id].dom.cells[n].active){var s=$(n),a=TableKit.Editable.getCellEditor(s);a.cancel(s)}}TableKit.tables[e.id].dom={head:null,rows:null,cells:{}}}},reloadTable:function(e){e=$(e),TableKit.unloadTable(e);var t=TableKit.option("sortable resizable editable",e.id);t.sortable&&TableKit.Sortable.init(e),t.resizable&&TableKit.Resizable.init(e),t.editable&&TableKit.Editable.init(e)},reload:function(){for(var e in TableKit.tables)TableKit.reloadTable(e)},load:function(){TableKit.options.autoLoad&&(TableKit.options.sortable&&$A(TableKit.options.sortableSelector).each(function(e){$$(e).each(function(e){TableKit.Sortable.init(e)})}),TableKit.options.resizable&&$A(TableKit.options.resizableSelector).each(function(e){$$(e).each(function(e){TableKit.Resizable.init(e)})}),TableKit.options.editable&&$A(TableKit.options.editableSelector).each(function(e){$$(e).each(function(e){TableKit.Editable.init(e)})}))}}),TableKit.Rows={stripe:function(e){var t=TableKit.getBodyRows(e);t.each(function(t,i){TableKit.Rows.addStripeClass(e,t,i)})},addStripeClass:function(e,t,i){e=e||t.up("table");for(var n=TableKit.option("rowEvenClass rowOddClass",e.id),s=0===(i+1)%2?n[0]:n[1],a=t.className.split(/\s+/),o=[],l=0,r=a.length;r>l;l+=1)a[l]!==n[0]&&a[l]!==n[1]&&o.push(a[l]);o.push(s),t.className=o.join(" ")}},TableKit.Sortable={init:function(e,t){var i=$(e);if("TABLE"===i.tagName){TableKit.register(i,Object.extend(t||{},{sortable:!0}));var n,s=TableKit.getHeaderCells(i),a=TableKit.option("noSortClass columnClass sortFirstAscendingClass sortFirstDecendingClass",i.id);s.each(function(e){e=$(e),e.hasClassName(a.noSortClass)||(Event.observe(e,"mousedown",TableKit.Sortable._sort),e.addClassName(a.columnClass),(e.hasClassName(a.sortFirstAscendingClass)||e.hasClassName(a.sortFirstDecendingClass))&&(n=e))}),n?n.hasClassName(a.sortFirstAscendingClass)?TableKit.Sortable.sort(i,n,1):TableKit.Sortable.sort(i,n,-1):TableKit.Rows.stripe(i)}},reload:function(e){e=$(e);var t=TableKit.getHeaderCells(e),i=TableKit.option("noSortClass columnClass",e.id);t.each(function(e){e=$(e),e.hasClassName(i.noSortClass)||(Event.stopObserving(e,"mousedown",TableKit.Sortable._sort),e.removeClassName(i.columnClass))}),TableKit.Sortable.init(e)},_sort:function(e){if(!TableKit.Resizable._onHandle){e=TableKit.e(e),Event.stop(e);for(var t=Event.element(e);!t.tagName||!t.tagName.match(/td|th/gi);)t=t.parentNode;TableKit.Sortable.sort(null,t)}},sort:function(e,t,i){var n;if("number"==typeof t){if(!e||e.tagName&&"TABLE"!==e.tagName)return;e=$(e),t=Math.min(e.rows[0].cells.length,t),t=Math.max(1,t),t-=1,n=e.tHead&&e.tHead.rows.length>0?$(e.tHead.rows[e.tHead.rows.length-1].cells[t]):$(e.rows[0].cells[t])}else n=$(t),e=e?$(e):n.up("table"),t=TableKit.getCellIndex(n);var s=TableKit.option("noSortClass descendingClass ascendingClass defaultSortDirection",e.id);if(!n.hasClassName(s.noSortClass)){i=i?i:s.defaultSortDirection;var a=TableKit.getBodyRows(e);if(n.hasClassName(s.ascendingClass)||n.hasClassName(s.descendingClass))a.reverse(),i=n.hasClassName(s.descendingClass)?1:-1;else{var o=TableKit.Sortable.getDataType(n,t,e),l=TableKit.Sortable.types;a.sort(function(e,n){return i*l[o].compare(TableKit.getCellText(e.cells[t]),TableKit.getCellText(n.cells[t]))})}var r=e.tBodies[0],u=TableKit.Rows;a.each(function(t,i){r.appendChild(t),u.addStripeClass(e,t,i)});var c=TableKit.getHeaderCells(null,n);$A(c).each(function(e,n){e=$(e),e.removeClassName(s.ascendingClass),e.removeClassName(s.descendingClass),t===n&&(1===i?e.addClassName(s.ascendingClass):e.addClassName(s.descendingClass))})}},types:{},detectors:[],addSortType:function(){$A(arguments).each(function(e){TableKit.Sortable.types[e.name]=e})},getDataType:function(e,t,i){e=$(e),t=t||0===t?t:TableKit.getCellIndex(e);var n=TableKit.Sortable._coltypecache,s=n[i.id]?n[i.id]:n[i.id]={};if(!s[t]){var a=!1;if(e.id&&TableKit.Sortable.types[e.id]&&(a=e.id),a||(a=$w(e.className).detect(function(e){return TableKit.Sortable.types[e]?!0:!1})),!a){var o=TableKit.getBodyRows(i);e=o[0].cells[t],a=TableKit.Sortable.detectors.detect(function(t){return TableKit.Sortable.types[t].detect(TableKit.getCellText(e))})}s[t]=a}return s[t]},_coltypecache:{}},TableKit.Sortable.detectors=$A($w("date-iso date date-eu date-au time currency datasize number casesensitivetext text")),TableKit.Sortable.Type=Class.create(),TableKit.Sortable.Type.prototype={initialize:function(e,t){this.name=e,t=Object.extend({normal:function(e){return e},pattern:/.*/},t||{}),this.normal=t.normal,this.pattern=t.pattern,t.compare&&(this.compare=t.compare),t.detect&&(this.detect=t.detect)},compare:function(e,t){return TableKit.Sortable.Type.compare(this.normal(e),this.normal(t))},detect:function(e){return this.pattern.test(e)}},TableKit.Sortable.Type.compare=function(e,t){return t>e?-1:e===t?0:1},TableKit.Sortable.addSortType(new TableKit.Sortable.Type("number",{pattern:/^[-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?/,normal:function(e){return e=parseFloat(e.replace(/^.*?([-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?).*$/,"$1")),isNaN(e)?0:e}}),new TableKit.Sortable.Type("text",{normal:function(e){return e?e.toLowerCase():""}}),new TableKit.Sortable.Type("casesensitivetext",{pattern:/^[A-Z]+$/}),new TableKit.Sortable.Type("datasize",{pattern:/^[-+]?[\d]*\.?[\d]+(?:[eE][-+]?[\d]+)?\s?[k|m|g|t]b$/i,normal:function(e){var t=e.match(/^([-+]?[\d]*\.?[\d]+([eE][-+]?[\d]+)?)\s?([k|m|g|t]?b)?/i),i=t[1]?Number(t[1]).valueOf():0,n=t[3]?t[3].substr(0,1).toLowerCase():"",s=i;switch(n){case"k":s=1024*i;break;case"m":s=1024*1024*i;break;case"g":s=1024*1024*1024*i;break;case"t":s=1024*1024*1024*1024*i}return s}}),new TableKit.Sortable.Type("date-au",{pattern:/^\d{2}\/\d{2}\/\d{4}\s?(?:\d{1,2}\:\d{2}(?:\:\d{2})?\s?[a|p]?m?)?/i,normal:function(e){if(!this.pattern.test(e))return 0;var t=e.match(/^(\d{2})\/(\d{2})\/(\d{4})\s?(?:(\d{1,2})\:(\d{2})(?:\:(\d{2}))?\s?([a|p]?m?))?/i),i=t[3],n=parseInt(t[2],10)-1,s=t[1],a=t[4]?t[4]:0;if(t[7]){var o=parseInt(t[4],10);-1!==t[7].toLowerCase().indexOf("p")?a=12>o?o+12:o:-1!==t[7].toLowerCase().indexOf("a")&&(a=12>o?o:0)}var l=t[5]?t[5]:0,r=t[6]?t[6]:0;return new Date(i,n,s,a,l,r,0).valueOf()}}),new TableKit.Sortable.Type("date-us",{pattern:/^\d{2}\/\d{2}\/\d{4}\s?(?:\d{1,2}\:\d{2}(?:\:\d{2})?\s?[a|p]?m?)?/i,normal:function(e){if(!this.pattern.test(e))return 0;var t=e.match(/^(\d{2})\/(\d{2})\/(\d{4})\s?(?:(\d{1,2})\:(\d{2})(?:\:(\d{2}))?\s?([a|p]?m?))?/i),i=t[3],n=parseInt(t[1],10)-1,s=t[2],a=t[4]?t[4]:0;if(t[7]){var o=parseInt(t[4],10);-1!==t[7].toLowerCase().indexOf("p")?a=12>o?o+12:o:-1!==t[7].toLowerCase().indexOf("a")&&(a=12>o?o:0)}var l=t[5]?t[5]:0,r=t[6]?t[6]:0;return new Date(i,n,s,a,l,r,0).valueOf()}}),new TableKit.Sortable.Type("date-eu",{pattern:/^\d{2}-\d{2}-\d{4}/i,normal:function(e){if(!this.pattern.test(e))return 0;var t=e.match(/^(\d{2})-(\d{2})-(\d{4})/),i=t[3],n=parseInt(t[2],10)-1,s=t[1];return new Date(i,n,s).valueOf()}}),new TableKit.Sortable.Type("date-iso",{pattern:/[\d]{4}-[\d]{2}-[\d]{2}(?:T[\d]{2}\:[\d]{2}(?:\:[\d]{2}(?:\.[\d]+)?)?(Z|([-+][\d]{2}:[\d]{2})?)?)?/,normal:function(e){if(!this.pattern.test(e))return 0;var t=e.match(/([\d]{4})(-([\d]{2})(-([\d]{2})(T([\d]{2}):([\d]{2})(:([\d]{2})(\.([\d]+))?)?(Z|(([-+])([\d]{2}):([\d]{2})))?)?)?)?/),i=0,n=new Date(t[1],0,1);if(t[3]&&n.setMonth(t[3]-1),t[5]&&n.setDate(t[5]),t[7]&&n.setHours(t[7]),t[8]&&n.setMinutes(t[8]),t[10]&&n.setSeconds(t[10]),t[12]&&n.setMilliseconds(1e3*Number("0."+t[12])),t[14]&&(i=60*Number(t[16])+Number(t[17]),i*="-"===t[15]?1:-1),i-=n.getTimezoneOffset(),0!==i){var s=Number(n)+1e3*60*i;n.setTime(Number(s))}return n.valueOf()}}),new TableKit.Sortable.Type("date",{pattern:/^(?:sun|mon|tue|wed|thu|fri|sat)\,\s\d{1,2}\s(?:jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\s\d{4}(?:\s\d{2}\:\d{2}(?:\:\d{2})?(?:\sGMT(?:[+-]\d{4})?)?)?/i,compare:function(e,t){return e&&t?TableKit.Sortable.Type.compare(new Date(e),new Date(t)):TableKit.Sortable.Type.compare(e?1:0,t?1:0)}}),new TableKit.Sortable.Type("time",{pattern:/^\d{1,2}\:\d{2}(?:\:\d{2})?(?:\s[a|p]m)?$/i,compare:function(e,t){var i=new Date,n=i.getMonth()+"/"+i.getDate()+"/"+i.getFullYear()+" ";return TableKit.Sortable.Type.compare(new Date(n+e),new Date(n+t))}}),new TableKit.Sortable.Type("currency",{pattern:/^[$����]/,normal:function(e){return e?parseFloat(e.replace(/[^-\d\.]/g,"")):0}})),TableKit.Resizable={init:function(e,t){var i=$(e);if("TABLE"===i.tagName){TableKit.register(i,Object.extend(t||{},{resizable:!0}));var n=TableKit.getHeaderCells(i);n.each(function(e){e=$(e),"actions"!=e.id&&(Event.observe(e,"mouseover",TableKit.Resizable.initDetect),Event.observe(e,"mouseout",TableKit.Resizable.killDetect))})}},resize:function(e,t,i){var n;if("number"==typeof t){if(!e||e.tagName&&"TABLE"!==e.tagName)return;e=$(e),t=Math.min(e.rows[0].cells.length,t),t=Math.max(1,t),t-=1,n=e.tHead&&e.tHead.rows.length>0?$(e.tHead.rows[e.tHead.rows.length-1].cells[t]):$(e.rows[0].cells[t])}else n=$(t),e=e?$(e):n.up("table"),t=TableKit.getCellIndex(n);var s=parseInt(n.getStyle("paddingLeft"),10)+parseInt(n.getStyle("paddingRight"),10);i=Math.max(i-s,TableKit.option("minWidth",e.id)[0]),n.setStyle({width:i+"px"})},initDetect:function(e){e=TableKit.e(e);var t=Event.element(e);Event.observe(t,"mousemove",TableKit.Resizable.detectHandle),Event.observe(t,"mousedown",TableKit.Resizable.startResize)},detectHandle:function(e){e=TableKit.e(e);var t=Event.element(e);TableKit.Resizable.pointerPos(t,Event.pointerX(e),Event.pointerY(e))?(t.addClassName(TableKit.option("resizeOnHandleClass",t.up("table").id)[0]),TableKit.Resizable._onHandle=!0):(t.removeClassName(TableKit.option("resizeOnHandleClass",t.up("table").id)[0]),TableKit.Resizable._onHandle=!1)},killDetect:function(e){e=TableKit.e(e),TableKit.Resizable._onHandle=!1;var t=Event.element(e);Event.stopObserving(t,"mousemove",TableKit.Resizable.detectHandle),Event.stopObserving(t,"mousedown",TableKit.Resizable.startResize),t.removeClassName(TableKit.option("resizeOnHandleClass",t.up("table").id)[0])},startResize:function(e){if(e=TableKit.e(e),TableKit.Resizable._onHandle){var t=Event.element(e);Event.stopObserving(t,"mousemove",TableKit.Resizable.detectHandle),Event.stopObserving(t,"mousedown",TableKit.Resizable.startResize),Event.stopObserving(t,"mouseout",TableKit.Resizable.killDetect),TableKit.Resizable._cell=t;var i=t.up("table");TableKit.Resizable._tbl=i,TableKit.option("showHandle",i.id)[0]&&(TableKit.Resizable._handle=$(document.createElement("div")).addClassName("resize-handle").setStyle({top:t.cumulativeOffset()[1]+"px",left:Event.pointerX(e)+"px",height:i.getDimensions().height+"px"}),document.body.appendChild(TableKit.Resizable._handle)),Event.observe(document,"mousemove",TableKit.Resizable.drag),Event.observe(document,"mouseup",TableKit.Resizable.endResize),Event.stop(e)}},endResize:function(e){e=TableKit.e(e);var t=TableKit.Resizable._cell;TableKit.Resizable.resize(null,t,Event.pointerX(e)-t.cumulativeOffset()[0]),Event.stopObserving(document,"mousemove",TableKit.Resizable.drag),Event.stopObserving(document,"mouseup",TableKit.Resizable.endResize),TableKit.option("showHandle",TableKit.Resizable._tbl.id)[0]&&$$("div.resize-handle").each(function(e){document.body.removeChild(e)}),Event.observe(t,"mouseout",TableKit.Resizable.killDetect),TableKit.Resizable._tbl=TableKit.Resizable._handle=TableKit.Resizable._cell=null,Event.stop(e)},drag:function(e){if(e=TableKit.e(e),null===TableKit.Resizable._handle)try{TableKit.Resizable.resize(TableKit.Resizable._tbl,TableKit.Resizable._cell,Event.pointerX(e)-TableKit.Resizable._cell.cumulativeOffset()[0])}catch(e){}else TableKit.Resizable._handle.setStyle({left:Event.pointerX(e)+"px"});return!1},pointerPos:function(e,t,i){var n=$(e).cumulativeOffset();return i>=n[1]&&n[1]+e.offsetHeight>i&&t>=n[0]+e.offsetWidth-5&&n[0]+e.offsetWidth>t},_onHandle:!1,_cell:null,_tbl:null,_handle:null},TableKit.Editable={init:function(e,t){var i=$(e);"TABLE"===i.tagName&&(TableKit.register(i,Object.extend(t||{},{editable:!0})),Event.observe(i.tBodies[0],"click",TableKit.Editable._editCell))},_editCell:function(e){e=TableKit.e(e);var t=Event.findElement(e,"td");return t?(TableKit.Editable.editCell(null,t,null,e),void 0):!1},editCell:function(e,t,i,n){var s,a;if("number"==typeof t){if(!e||e.tagName&&"TABLE"!==e.tagName)return;e=$(e),t=Math.min(e.tBodies[0].rows.length,t),t=Math.max(1,t),t-=1,i=Math.min(e.rows[0].cells.length,i),i=Math.max(1,i),i-=1,a=$(e.tBodies[0].rows[t]),s=$(a.cells[i])}else s=$(n?Event.findElement(n,"td"):t),e=e&&e.tagName&&"TABLE"!==e.tagName?$(e):s.up("table"),a=s.up("tr");var o=TableKit.option("noEditClass",e.id);if(!s.hasClassName(o.noEditClass)){var l=$(TableKit.getHeaderCells(e,s)[TableKit.getCellIndex(s)]);if(!l.hasClassName(o.noEditClass)){var r=TableKit.getCellData(s);if(!r.active){r.htmlContent=s.innerHTML;var u=TableKit.Editable.getCellEditor(null,null,l);u.edit(s,n),r.active=!0}}}},getCellEditor:function(e,t,i){var i=i?i:$(TableKit.getHeaderCells(t,e)[TableKit.getCellIndex(e)]),n=TableKit.Editable.types["text-input"];if(i.id&&TableKit.Editable.types[i.id])n=TableKit.Editable.types[i.id];else{var s=$w(i.className).detect(function(e){return TableKit.Editable.types[e]?!0:!1});n=s?TableKit.Editable.types[s]:n}return n},types:{},addCellEditor:function(e){e&&e.name&&(TableKit.Editable.types[e.name]=e)}},TableKit.Editable.CellEditor=Class.create(),TableKit.Editable.CellEditor.prototype={initialize:function(e,t){this.name=e,this.options=Object.extend({element:"input",attributes:{name:"value",type:"text"},selectOptions:[],showSubmit:!0,submitText:"OK",showCancel:!0,cancelText:"Cancel",ajaxURI:null,ajaxOptions:null},t||{})},edit:function(e){if(e=$(e),!e.hasClassName("static")){var t=this.options,i=e.up("table"),n=$(document.createElement("form"));n.id=e.id+"-form",n.addClassName(TableKit.option("formClassName",i.id)[0]),n.onsubmit=this._submit.bindAsEventListener(this);var s=document.createElement(t.element);switch($H(t.attributes).each(function(e){s[e.key]=e.value}),t.element){case"input":case"textarea":s.value=TableKit.getCellText(e);break;case"select":var a=TableKit.getCellText(e);$A(t.selectOptions).each(function(e){s.options[s.options.length]=new Option(e[0],e[1]),a===e[1]&&(s.options[s.options.length-1].selected="selected")})}if(n.appendChild(s),"textarea"===t.element&&n.appendChild(document.createElement("br")),t.showSubmit){var o=document.createElement("input");o.type="submit",o.value=t.submitText,o.className="editor_ok_button",n.appendChild(o)}if(t.showCancel){var l=document.createElement("a");l.href="#",l.appendChild(document.createTextNode(t.cancelText)),l.onclick=this._cancel.bindAsEventListener(this),l.className="editor_cancel",n.appendChild(l)}e.innerHTML="",e.appendChild(n)}},_submit:function(e){var t=Event.findElement(e,"td"),i=Event.findElement(e,"form");Event.stop(e),this.submit(t,i)},submit:function(e,t){if(!i.ajaxURI&&!TableKit.option("editAjaxURI",a.id)[0])return e.update(t),void 0;var i=this.options;t=t?t:e.down("form");var n=$(TableKit.getHeaderCells(null,e)[TableKit.getCellIndex(e)]),s=e.up("tr"),a=e.up("table"),o="&row="+(TableKit.getRowIndex(s)+1)+"&cell="+(TableKit.getCellIndex(e)+1)+"&id="+s.id+"&field="+n.id+"&"+Form.serialize(t);this.ajax=new Ajax.Updater(e,i.ajaxURI||TableKit.option("editAjaxURI",a.id)[0],Object.extend(i.ajaxOptions||TableKit.option("editAjaxOptions",a.id)[0],{postBody:o,onComplete:function(){var t=TableKit.getCellData(e);t.active=!1,t.refresh=!0}}))},_cancel:function(e){var t=Event.findElement(e,"td");Event.stop(e),this.cancel(t)},cancel:function(e){this.ajax=null;var t=TableKit.getCellData(e);e.innerHTML=t.htmlContent,t.htmlContent="",t.active=!1},ajax:null},TableKit.Editable.textInput=function(e,t){TableKit.Editable.addCellEditor(new TableKit.Editable.CellEditor(e,{element:"input",attributes:Object.extend({name:"value",type:"text"},t||{})}))},TableKit.Editable.textInput("text-input"),TableKit.Editable.multiLineInput=function(e,t){TableKit.Editable.addCellEditor(new TableKit.Editable.CellEditor(e,{element:"textarea",attributes:Object.extend({name:"value",rows:"5",cols:"20"},t||{})}))},TableKit.Editable.multiLineInput("multi-line-input"),TableKit.Editable.selectInput=function(e,t,i){TableKit.Editable.addCellEditor(new TableKit.Editable.CellEditor(e,{element:"select",attributes:Object.extend({name:"value"},t||{}),selectOptions:i}))},Object.extend(TableKit.options||{},{trueResize:!1,keepWidth:!1}),Object.extend(TableKit.Resizable,{resize:function(e,t,i){var n;if("number"==typeof t){if(!e||e.tagName&&"TABLE"!==e.tagName)return;e=$(e),t=Math.min(e.rows[0].cells.length,t),t=Math.max(1,t),t-=1,n=e.tHead&&e.tHead.rows.length>0?$(e.tHead.rows[e.tHead.rows.length-1].cells[t]):$(e.rows[0].cells[t])}else n=$(t),e=e?$(e):n.up("table"),t=TableKit.getCellIndex(n);var s=TableKit.option("trueResize keepWidth minWidth",e.id),a=parseInt(n.getStyle("paddingLeft"),10)+parseInt(n.getStyle("paddingRight"),10);if(a+=parseInt(n.getStyle("borderLeftWidth"),10)+parseInt(n.getStyle("borderRightWidth"),10),i=Math.max(i-a,s.minWidth),s.trueResize){var o=i+a-parseInt(n.getWidth());if(s.keepWidth){var l=TableKit.getHeaderCells(e);if(0>t||t>l.length)return;var r;r=t==l.length-1?l[t-1]:l[t+1];var u,c=parseInt(r.getWidth()),d=parseInt(r.getStyle("paddingLeft"),10)+parseInt(r.getStyle("paddingRight"),10),h=c-d-o;s.minWidth>h?(u=Math.min(c-d,s.minWidth),i-=u-h):u=h,r.setStyle({width:u+"px"}),n.setStyle({width:i+"px"})}else{var p=parseInt(e.getWidth())+o;n.setStyle({width:i+"px"}),e.setStyle({width:p+"px"})}}else n.setStyle({width:i+"px"})}}),document.observe("dom:loaded",TableKit.load);var qq=qq||{};qq.extend=function(e,t){for(var i in t)e[i]=t[i]},qq.indexOf=function(e,t,i){if(e.indexOf)return e.indexOf(t,i);i=i||0;var n=e.length;for(0>i&&(i+=n);n>i;i++)if(i in e&&e[i]===t)return i;return-1},qq.getUniqueId=function(){var e=0;return function(){return e++}}(),qq.attach=function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},qq.detach=function(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.attachEvent&&e.detachEvent("on"+t,i)},qq.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},qq.insertBefore=function(e,t){t.parentNode.insertBefore(e,t)},qq.remove=function(e){e.parentNode.removeChild(e)},qq.contains=function(e,t){return e==t?!0:e.contains?e.contains(t):!!(8&t.compareDocumentPosition(e))},qq.toElement=function(){var e=document.createElement("div");return function(t){e.innerHTML=t;var i=e.firstChild;return e.removeChild(i),i}}(),qq.css=function(e,t){null!=t.opacity&&"string"!=typeof e.style.opacity&&e.filters!==void 0&&(t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"),qq.extend(e.style,t)},qq.hasClass=function(e,t){var i=RegExp("(^| )"+t+"( |$)");return i.test(e.className)},qq.addClass=function(e,t){qq.hasClass(e,t)||(e.className+=" "+t)},qq.removeClass=function(e,t){var i=RegExp("(^| )"+t+"( |$)");e.className=e.className.replace(i," ").replace(/^\s+|\s+$/g,"")},qq.setText=function(e,t){e.innerText=t,e.textContent=t},qq.children=function(e){for(var t=[],i=e.firstChild;i;)1==i.nodeType&&t.push(i),i=i.nextSibling;return t},qq.getByClass=function(e,t){if(e.querySelectorAll)return e.querySelectorAll("."+t);for(var i=[],n=e.getElementsByTagName("*"),s=n.length,a=0;s>a;a++)qq.hasClass(n[a],t)&&i.push(n[a]);return i},qq.obj2url=function(e,t,i){var n=[],s="&",a=function(e,i){var s=t?/\[\]$/.test(t)?t:t+"["+i+"]":i;"undefined"!=s&&"undefined"!=i&&n.push("object"==typeof e?qq.obj2url(e,s,!0):"[object Function]"===Object.prototype.toString.call(e)?encodeURIComponent(s)+"="+encodeURIComponent(e()):encodeURIComponent(s)+"="+encodeURIComponent(e))};if(!i&&t)s=/\?/.test(t)?/\?$/.test(t)?"":"&":"?",n.push(t),n.push(qq.obj2url(e));else if("[object Array]"===Object.prototype.toString.call(e)&&e!==void 0)for(var o=0,l=e.length;l>o;++o)a(e[o],o);else if(e!==void 0&&null!==e&&"object"==typeof e)for(var o in e)a(e[o],o);else n.push(encodeURIComponent(t)+"="+encodeURIComponent(e));return n.join(s).replace(/^&/,"").replace(/%20/g,"+")};var qq=qq||{};if(qq.FileUploaderBasic=function(e){this._options={debug:!1,action:"/server/upload",params:{},button:null,multiple:!0,maxConnections:3,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(){},onProgress:function(){},onComplete:function(){},onCancel:function(){},messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(){}},qq.extend(this._options,e),this._filesInProgress=0,this._handler=this._createUploadHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._preventLeaveInProgress()},qq.FileUploaderBasic.prototype={setParams:function(e){this._options.params=e},getInProgress:function(){return this._filesInProgress},_createUploadButton:function(e){var t=this;return new qq.UploadButton({element:e,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(e){t._onInputChange(e)}})},_createUploadHandler:function(){var e,t=this;e=qq.UploadHandlerXhr.isSupported()?"UploadHandlerXhr":"UploadHandlerForm";var i=new qq[e]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(e,i,n,s){t._onProgress(e,i,n,s),t._options.onProgress(e,i,n,s)},onComplete:function(e,i,n){t._onComplete(e,i,n),t._options.onComplete(e,i,n)},onCancel:function(e,i){t._onCancel(e,i),t._options.onCancel(e,i)}});return i},_preventLeaveInProgress:function(){var e=this;qq.attach(window,"beforeunload",function(t){if(e._filesInProgress){var t=t||window.event;return t.returnValue=e._options.messages.onLeave,e._options.messages.onLeave}})},_onSubmit:function(){this._filesInProgress++},_onProgress:function(){},_onComplete:function(e,t,i){this._filesInProgress--,i.error&&this._options.showMessage(i.error)},_onCancel:function(){this._filesInProgress--},_onInputChange:function(e){this._handler instanceof qq.UploadHandlerXhr?this._uploadFileList(e.files):this._validateFile(e)&&this._uploadFile(e),this._button.reset()},_uploadFileList:function(e){for(var t=0;e.length>t;t++)if(!this._validateFile(e[t]))return;for(var t=0;e.length>t;t++)this._uploadFile(e[t])},_uploadFile:function(e){var t=this._handler.add(e),i=this._handler.getName(t);this._options.onSubmit(t,i)!==!1&&(this._onSubmit(t,i),this._handler.upload(t,this._options.params))},_validateFile:function(e){var t,i;return e.value?t=e.value.replace(/.*(\/|\\)/,""):(t=null!=e.fileName?e.fileName:e.name,i=null!=e.fileSize?e.fileSize:e.size),this._isAllowedExtension(t)?0===i?(this._error("emptyError",t),!1):i&&this._options.sizeLimit&&i>this._options.sizeLimit?(this._error("sizeError",t),!1):i&&this._options.minSizeLimit>i?(this._error("minSizeError",t),!1):!0:(this._error("typeError",t),!1)},_error:function(e,t){function i(e,t){n=n.replace(e,t)}var n=this._options.messages[e];i("{file}",this._formatFileName(t)),i("{extensions}",this._options.allowedExtensions.join(", ")),i("{sizeLimit}",this._formatSize(this._options.sizeLimit)),i("{minSizeLimit}",this._formatSize(this._options.minSizeLimit)),this._options.showMessage(n)},_formatFileName:function(e){return e.length>33&&(e=e.slice(0,19)+"..."+e.slice(-13)),e},_isAllowedExtension:function(e){var t=-1!==e.indexOf(".")?e.replace(/.*[.]/,"").toLowerCase():"",i=this._options.allowedExtensions;if(!i.length)return!0;for(var n=0;i.length>n;n++)if(i[n].toLowerCase()==t)return!0;return!1},_formatSize:function(e){var t=-1;do e/=1024,t++;while(e>99);return Math.max(e,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][t]}},qq.FileUploader=function(e){qq.FileUploaderBasic.apply(this,arguments),qq.extend(this._options,{element:null,listElement:null,template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button">Upload a file</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"}}),qq.extend(this._options,e),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button=this._createUploadButton(this._find(this._element,"button")),this._bindCancelEvent(),this._setupDragDrop()
},qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype),qq.extend(qq.FileUploader.prototype,{_find:function(e,t){var i=qq.getByClass(e,this._options.classes[t])[0];if(!i)throw Error("element not found "+t);return i},_setupDragDrop:function(){var e=this,t=this._find(this._element,"drop"),i=new qq.UploadDropZone({element:t,onEnter:function(i){qq.addClass(t,e._classes.dropActive),i.stopPropagation()},onLeave:function(e){e.stopPropagation()},onLeaveNotDescendants:function(){qq.removeClass(t,e._classes.dropActive)},onDrop:function(i){t.style.display="none",qq.removeClass(t,e._classes.dropActive),e._uploadFileList(i.dataTransfer.files)}});t.style.display="none",qq.attach(document,"dragenter",function(e){i._isValidFileDrag(e)&&(t.style.display="block")}),qq.attach(document,"dragleave",function(e){if(i._isValidFileDrag(e)){var n=document.elementFromPoint(e.clientX,e.clientY);n&&"HTML"!=n.nodeName||(t.style.display="none")}})},_onSubmit:function(e,t){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(e,t)},_onProgress:function(e,t,i,n){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var s=this._getItemByFileId(e),a=this._find(s,"size");a.style.display="inline";var o;o=i!=n?Math.round(100*(i/n))+"% from "+this._formatSize(n):this._formatSize(n),qq.setText(a,o)},_onComplete:function(e,t,i){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var n=this._getItemByFileId(e);i.success?Notifications.Display(2,"File "+t+" successfully uploaded"):i.error&&Notifications.Display(5,i.error),qq.remove(n)},_addToList:function(e,t){var i=qq.toElement(this._options.fileTemplate);i.qqFileId=e;var n=this._find(i,"file");qq.setText(n,this._formatFileName(t)),this._find(i,"size").style.display="none",this._listElement.appendChild(i)},_getItemByFileId:function(e){for(var t=this._listElement.firstChild;t;){if(t.qqFileId==e)return t;t=t.nextSibling}},_bindCancelEvent:function(){var e=this,t=this._listElement;qq.attach(t,"click",function(t){t=t||window.event;var i=t.target||t.srcElement;if(qq.hasClass(i,e._classes.cancel)){qq.preventDefault(t);var n=i.parentNode;e._handler.cancel(n.qqFileId),qq.remove(n)}})}}),qq.UploadDropZone=function(e){this._options={element:null,onEnter:function(){},onLeave:function(){},onLeaveNotDescendants:function(){},onDrop:function(){}},qq.extend(this._options,e),this._element=this._options.element,this._disableDropOutside(),this._attachEvents()},qq.UploadDropZone.prototype={_disableDropOutside:function(){qq.UploadDropZone.dropOutsideDisabled||(qq.attach(document,"dragover",function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none",e.preventDefault())}),qq.UploadDropZone.dropOutsideDisabled=!0)},_attachEvents:function(){var e=this;qq.attach(e._element,"dragover",function(t){if(e._isValidFileDrag(t)){var i=t.dataTransfer.effectAllowed;t.dataTransfer.dropEffect="move"==i||"linkMove"==i?"move":"copy",t.stopPropagation(),t.preventDefault()}}),qq.attach(e._element,"dragenter",function(t){e._isValidFileDrag(t)&&e._options.onEnter(t)}),qq.attach(e._element,"dragleave",function(t){if(e._isValidFileDrag(t)){e._options.onLeave(t);var i=document.elementFromPoint(t.clientX,t.clientY);qq.contains(this,i)||e._options.onLeaveNotDescendants(t)}}),qq.attach(e._element,"drop",function(t){e._isValidFileDrag(t)&&(t.preventDefault(),e._options.onDrop(t))})},_isValidFileDrag:function(e){var t=e.dataTransfer,i=navigator.userAgent.indexOf("AppleWebKit")>-1;return t&&"none"!=t.effectAllowed&&(t.files||!i&&t.types.contains&&t.types.contains("Files"))}},qq.UploadButton=function(e){this._options={element:null,multiple:!1,name:"file",onChange:function(){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"},qq.extend(this._options,e),this._element=this._options.element,qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"}),this._input=this._createInput()},qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&qq.remove(this._input),qq.removeClass(this._element,this._options.focusClass),this._input=this._createInput()},_createInput:function(){var e=document.createElement("input");this._options.multiple&&e.setAttribute("multiple","multiple"),e.setAttribute("type","file"),e.setAttribute("name",this._options.name),qq.css(e,{position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),this._element.appendChild(e);var t=this;return qq.attach(e,"change",function(){t._options.onChange(e)}),qq.attach(e,"mouseover",function(){qq.addClass(t._element,t._options.hoverClass)}),qq.attach(e,"mouseout",function(){qq.removeClass(t._element,t._options.hoverClass)}),qq.attach(e,"focus",function(){qq.addClass(t._element,t._options.focusClass)}),qq.attach(e,"blur",function(){qq.removeClass(t._element,t._options.focusClass)}),window.attachEvent&&e.setAttribute("tabIndex","-1"),e}},qq.UploadHandlerAbstract=function(e){this._options={debug:!1,action:"/upload.php",maxConnections:999,onProgress:function(){},onComplete:function(){},onCancel:function(){}},qq.extend(this._options,e),this._queue=[],this._params=[]},qq.UploadHandlerAbstract.prototype={log:function(e){this._options.debug&&window.console&&console.log("[uploader] "+e)},add:function(){},upload:function(e,t){var i=this._queue.push(e),n={};qq.extend(n,t),this._params[e]=n,this._options.maxConnections>=i&&this._upload(e,this._params[e])},cancel:function(e){this._cancel(e),this._dequeue(e)},cancelAll:function(){for(var e=0;this._queue.length>e;e++)this._cancel(this._queue[e]);this._queue=[]},getName:function(){},getSize:function(){},getQueue:function(){return this._queue},_upload:function(){},_cancel:function(){},_dequeue:function(e){var t=qq.indexOf(this._queue,e);this._queue.splice(t,1);var i=this._options.maxConnections;if(this._queue.length>=i){var n=this._queue[i-1];this._upload(n,this._params[n])}}},qq.UploadHandlerForm=function(){qq.UploadHandlerAbstract.apply(this,arguments),this._inputs={}},qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerForm.prototype,{add:function(e){e.setAttribute("name","qqfile");var t="qq-upload-handler-iframe"+qq.getUniqueId();return this._inputs[t]=e,e.parentNode&&qq.remove(e),t},getName:function(e){return this._inputs[e].value.replace(/.*(\/|\\)/,"")},_cancel:function(e){this._options.onCancel(e,this.getName(e)),delete this._inputs[e];var t=document.getElementById(e);t&&(t.setAttribute("src","javascript:false;"),qq.remove(t))},_upload:function(e,t){var i=this._inputs[e];if(!i)throw Error("file with passed id was not added, or already uploaded or cancelled");var n=this.getName(e),s=this._createIframe(e),a=this._createForm(s,t);a.appendChild(i);var o=this;return this._attachLoadEvent(s,function(){o.log("iframe loaded");var t=o._getIframeContentJSON(s);o._options.onComplete(e,n,t),o._dequeue(e),delete o._inputs[e],setTimeout(function(){qq.remove(s)},1)}),a.submit(),qq.remove(a),e},_attachLoadEvent:function(e,t){qq.attach(e,"load",function(){e.parentNode&&(e.contentDocument&&e.contentDocument.body&&"false"==e.contentDocument.body.innerHTML||t())})},_getIframeContentJSON:function(iframe){var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON"),this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")")}catch(err){response={}}return response},_createIframe:function(e){var t=qq.toElement('<iframe src="javascript:false;" name="'+e+'" />');return t.setAttribute("id",e),t.style.display="none",document.body.appendChild(t),t},_createForm:function(e,t){var i=qq.toElement('<form method="post" enctype="multipart/form-data"></form>'),n=qq.obj2url(t,this._options.action);return i.setAttribute("action",n),i.setAttribute("target",e.name),i.style.display="none",document.body.appendChild(i),i}}),qq.UploadHandlerXhr=function(){qq.UploadHandlerAbstract.apply(this,arguments),this._files=[],this._xhrs=[],this._loaded=[]},qq.UploadHandlerXhr.isSupported=function(){var e=document.createElement("input");return e.type="file","multiple"in e&&"undefined"!=typeof File&&(new XMLHttpRequest).upload!==void 0},qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype),qq.extend(qq.UploadHandlerXhr.prototype,{add:function(e){if(!(e instanceof File))throw Error("Passed obj in not a File (in qq.UploadHandlerXhr)");return this._files.push(e)-1},getName:function(e){var t=this._files[e];return null!=t.fileName?t.fileName:t.name},getSize:function(e){var t=this._files[e];return null!=t.fileSize?t.fileSize:t.size},getLoaded:function(e){return this._loaded[e]||0},_upload:function(e,t){var i=this._files[e],n=this.getName(e);this.getSize(e),this._loaded[e]=0;var s=this._xhrs[e]=new XMLHttpRequest,a=this;s.upload.onprogress=function(t){t.lengthComputable&&(a._loaded[e]=t.loaded,a._options.onProgress(e,n,t.loaded,t.total))},s.onreadystatechange=function(){4==s.readyState&&a._onComplete(e,s)},t=t||{},t.qqfile=n;var o=qq.obj2url(t,this._options.action);s.open("POST",o,!0),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.setRequestHeader("X-File-Name",encodeURIComponent(n)),s.setRequestHeader("Content-Type","application/octet-stream"),s.send(i)},_onComplete:function(id,xhr){if(this._files[id]){var name=this.getName(id),size=this.getSize(id);if(this._options.onProgress(id,name,size,size),200==xhr.status){this.log("xhr - server response received"),this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}}this._options.onComplete(id,name,response)}else this._options.onComplete(id,name,{});this._files[id]=null,this._xhrs[id]=null,this._dequeue(id)}},_cancel:function(e){this._options.onCancel(e,this.getName(e)),this._files[e]=null,this._xhrs[e]&&(this._xhrs[e].abort(),this._xhrs[e]=null)}}),!Control)var Control={};Control.Slider=Class.create({initialize:function(e,t,i){var n=this;this.handles=Object.isArray(e)?e.collect(function(e){return $(e)}):[$(e)],this.track=$(t),this.options=i||{},this.axis=this.options.axis||"horizontal",this.increment=this.options.increment||1,this.step=parseInt(this.options.step||"1"),this.range=this.options.range||$R(0,1),this.value=0,this.values=this.handles.map(function(){return 0}),this.spans=this.options.spans?this.options.spans.map(function(e){return $(e)}):!1,this.options.startSpan=$(this.options.startSpan||null),this.options.endSpan=$(this.options.endSpan||null),this.restricted=this.options.restricted||!1,this.maximum=this.options.maximum||this.range.end,this.minimum=this.options.minimum||this.range.start,this.alignX=parseInt(this.options.alignX||"0"),this.alignY=parseInt(this.options.alignY||"0"),this.trackLength=this.maximumOffset()-this.minimumOffset(),this.handleLength=this.isVertical()?0!=this.handles[0].offsetHeight?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,""):0!=this.handles[0].offsetWidth?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""),this.active=!1,this.dragging=!1,this.disabled=!1,this.options.disabled&&this.setDisabled(),this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):!1,this.allowedValues&&(this.minimum=this.allowedValues.min(),this.maximum=this.allowedValues.max()),this.eventMouseDown=this.startDrag.bindAsEventListener(this),this.eventMouseUp=this.endDrag.bindAsEventListener(this),this.eventMouseMove=this.update.bindAsEventListener(this),this.handles.each(function(e,t){t=n.handles.length-1-t,n.setValue(parseFloat((Object.isArray(n.options.sliderValue)?n.options.sliderValue[t]:n.options.sliderValue)||n.range.start),t),e.makePositioned().observe("mousedown",n.eventMouseDown),e.observe("touchstart",n.eventMouseDown)}),this.track.observe("mousedown",this.eventMouseDown),this.track.observe("touchstart",this.eventMouseDown),document.observe("mouseup",this.eventMouseUp),document.observe("touchend",this.eventMouseUp),document.observe("mousemove",this.eventMouseMove),document.observe("touchmove",this.eventMouseMove),this.initialized=!0},dispose:function(){var e=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown),Event.stopObserving(this.track,"touchstart",this.eventMouseDown),Event.stopObserving(document,"mouseup",this.eventMouseUp),Event.stopObserving(document,"touchend",this.eventMouseUp),Event.stopObserving(document,"mousemove",this.eventMouseMove),Event.stopObserving(document,"touchmove",this.eventMouseMove),this.handles.each(function(t){Event.stopObserving(t,"mousedown",e.eventMouseDown),Event.stopObserving(t,"touchstart",e.eventMouseDown)})},setDisabled:function(){this.disabled=!0},setEnabled:function(){this.disabled=!1},getNearestValue:function(e){if(this.allowedValues){if(e>=this.allowedValues.max())return this.allowedValues.max();if(this.allowedValues.min()>=e)return this.allowedValues.min();var t=Math.abs(this.allowedValues[0]-e),i=this.allowedValues[0];return this.allowedValues.each(function(n){var s=Math.abs(n-e);t>=s&&(i=n,t=s)}),i}return e>this.range.end?this.range.end:this.range.start>e?this.range.start:e},setValue:function(e,t){this.active||(this.activeHandleIdx=t||0,this.activeHandle=this.handles[this.activeHandleIdx],this.updateStyles()),t=t||this.activeHandleIdx||0,this.initialized&&this.restricted&&(t>0&&this.values[t-1]>e&&(e=this.values[t-1]),this.handles.length-1>t&&e>this.values[t+1]&&(e=this.values[t+1])),e=this.getNearestValue(e),this.values[t]=e,this.value=this.values[0],this.handles[t].style[this.isVertical()?"top":"left"]=this.translateToPx(e),this.drawSpans(),this.dragging&&this.event||this.updateFinished()},setValueBy:function(e,t){this.setValue(this.values[t||this.activeHandleIdx||0]+e,t||this.activeHandleIdx||0)},translateToPx:function(e){return Math.round((this.trackLength-this.handleLength)/(this.range.end-this.range.start)*(e-this.range.start))+"px"},translateToValue:function(e){return e/(this.trackLength-this.handleLength)*(this.range.end-this.range.start)+this.range.start},getRange:function(e){var t=this.values.sortBy(Prototype.K);return e=e||0,$R(t[e],t[e+1])},minimumOffset:function(){return this.isVertical()?this.alignY:this.alignX},maximumOffset:function(){return this.isVertical()?(0!=this.track.offsetHeight?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(0!=this.track.offsetWidth?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX},isVertical:function(){return"vertical"==this.axis},drawSpans:function(){var e=this;this.spans&&$R(0,this.spans.length-1).each(function(t){e.setSpan(e.spans[t],e.getRange(t))}),this.options.startSpan&&this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value)),this.options.endSpan&&this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))},setSpan:function(e,t){this.isVertical()?(e.style.top=this.translateToPx(t.start),e.style.height=this.translateToPx(t.end-t.start+this.range.start)):(e.style.left=this.translateToPx(t.start),e.style.width=this.translateToPx(t.end-t.start+this.range.start))},updateStyles:function(){this.handles.each(function(e){Element.removeClassName(e,"selected")}),Element.addClassName(this.activeHandle,"selected")},startDrag:function(e){if(Event.isLeftClick(e)||e.touches){if(!this.disabled){this.active=!0;var t=Event.element(e),i=e.touches?[e.touches[0].clientX,e.touches[0].clientY]:[Event.pointerX(e),Event.pointerY(e)],n=t;if(n==this.track){var s=this.track.cumulativeOffset();this.event=e,this.setValue(this.translateToValue((this.isVertical()?i[1]-s[1]:i[0]-s[0])-this.handleLength/2));var s=this.activeHandle.cumulativeOffset();this.offsetX=i[0]-s[0],this.offsetY=i[1]-s[1]}else{for(;-1==this.handles.indexOf(t)&&t.parentNode;)t=t.parentNode;if(-1!=this.handles.indexOf(t)){this.activeHandle=t,this.activeHandleIdx=this.handles.indexOf(this.activeHandle),this.updateStyles();var s=this.activeHandle.cumulativeOffset();this.offsetX=i[0]-s[0],this.offsetY=i[1]-s[1]}}}Event.stop(e)}},update:function(e){this.active&&(this.dragging||(this.dragging=!0),this.draw(e),Prototype.Browser.WebKit&&!e.touches&&window.scrollBy(0,0),Event.stop(e))},draw:function(e){var t=e.touches?[e.touches[0].clientX,e.touches[0].clientY]:[Event.pointerX(e),Event.pointerY(e)],i=this.track.cumulativeOffset();t[0]-=this.offsetX+i[0],t[1]-=this.offsetY+i[1],this.event=e,this.setValue(this.translateToValue(this.isVertical()?t[1]:t[0])),this.initialized&&this.options.onSlide&&this.options.onSlide(this.values.length>1?this.values:this.value,this)},endDrag:function(e){this.active&&this.dragging&&(this.finishDrag(e,!0),Event.stop(e)),this.active=!1,this.dragging=!1},finishDrag:function(){this.active=!1,this.dragging=!1,this.updateFinished()},updateFinished:function(){this.initialized&&this.options.onChange&&this.options.onChange(this.values.length>1?this.values:this.value,this),this.event=null}}),String.prototype.parseColor=function(){var e="#";if("rgb("==this.slice(0,4)){var t=this.slice(4,this.length-1).split(","),i=0;do e+=parseInt(t[i]).toColorPart();while(3>++i)}else if("#"==this.slice(0,1)){if(4==this.length)for(var i=1;4>i;i++)e+=(this.charAt(i)+this.charAt(i)).toLowerCase();7==this.length&&(e=this.toLowerCase())}return 7==e.length?e:arguments[0]||this},Element.collectTextNodes=function(e){return $A($(e).childNodes).collect(function(e){return 3==e.nodeType?e.nodeValue:e.hasChildNodes()?Element.collectTextNodes(e):""}).flatten().join("")},Element.collectTextNodesIgnoreClass=function(e,t){return $A($(e).childNodes).collect(function(e){return 3==e.nodeType?e.nodeValue:e.hasChildNodes()&&!Element.hasClassName(e,t)?Element.collectTextNodesIgnoreClass(e,t):""}).flatten().join("")},Element.setContentZoom=function(e,t){return e=$(e),e.setStyle({fontSize:t/100+"em"}),Prototype.Browser.WebKit&&window.scrollBy(0,0),e},Element.getInlineOpacity=function(e){return $(e).style.opacity||""},Element.forceRerendering=function(e){try{e=$(e);var t=document.createTextNode(" ");e.appendChild(t),e.removeChild(t)}catch(i){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(e){return-Math.cos(e*Math.PI)/2+.5},reverse:function(e){return 1-e},flicker:function(e){var e=-Math.cos(e*Math.PI)/4+.75+Math.random()/4;return e>1?1:e},wobble:function(e){return-Math.cos(e*Math.PI*9*e)/2+.5},pulse:function(e,t){return-Math.cos(2*e*((t||5)-.5)*Math.PI)/2+.5},spring:function(e){return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)},none:function(){return 0},full:function(){return 1}},DefaultOptions:{duration:1,fps:100,sync:!1,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(e){var t="position:relative";Prototype.Browser.IE&&(t+=";zoom:1"),e=$(e),$A(e.childNodes).each(function(i){3==i.nodeType&&(i.nodeValue.toArray().each(function(n){e.insertBefore(new Element("span",{style:t}).update(" "==n?String.fromCharCode(160):n),i)}),Element.remove(i))})},multiple:function(e,t){var i;i=("object"==typeof e||Object.isFunction(e))&&e.length?e:$(e).childNodes;var n=Object.extend({speed:.1,delay:0},arguments[2]||{}),s=n.delay;$A(i).each(function(e,i){new t(e,Object.extend(n,{delay:i*n.speed+s}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(e,t,i){return e=$(e),t=(t||"appear").toLowerCase(),Effect[Effect.PAIRS[t][e.visible()?1:0]](e,Object.extend({queue:{position:"end",scope:e.id||"global",limit:1}},i||{}))}};if(Effect.DefaultOptions.transition=Effect.Transitions.sinoidal,Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[],this.interval=null},_each:function(e){this.effects._each(e)},add:function(e){var t=(new Date).getTime(),i=Object.isString(e.options.queue)?e.options.queue:e.options.queue.position;switch(i){case"front":this.effects.findAll(function(e){return"idle"==e.state}).each(function(t){t.startOn+=e.finishOn,t.finishOn+=e.finishOn});break;case"with-last":t=this.effects.pluck("startOn").max()||t;break;case"end":t=this.effects.pluck("finishOn").max()||t}e.startOn+=t,e.finishOn+=t,(!e.options.queue.limit||this.effects.length<e.options.queue.limit)&&this.effects.push(e),this.interval||(this.interval=setInterval(this.loop.bind(this),15))},remove:function(e){this.effects=this.effects.reject(function(t){return t==e}),0==this.effects.length&&(clearInterval(this.interval),this.interval=null)},loop:function(){for(var e=(new Date).getTime(),t=0,i=this.effects.length;i>t;t++)this.effects[t]&&this.effects[t].loop(e)}}),Effect.Queues={instances:$H(),get:function(e){return Object.isString(e)?this.instances.get(e)||this.instances.set(e,new Effect.ScopedQueue):e}},Effect.Queue=Effect.Queues.get("global"),Effect.Base=Class.create({position:null,start:function(e){e&&e.transition===!1&&(e.transition=Effect.Transitions.linear),this.options=Object.extend(Object.extend({},Effect.DefaultOptions),e||{}),this.currentFrame=0,this.state="idle",this.startOn=1e3*this.options.delay,this.finishOn=this.startOn+1e3*this.options.duration,this.fromToDelta=this.options.to-this.options.from,this.totalTime=this.finishOn-this.startOn,this.totalFrames=this.options.fps*this.options.duration,this.render=function(){function e(e,t){e.options[t+"Internal"]&&e.options[t+"Internal"](e),e.options[t]&&e.options[t](e)}return function(t){"idle"===this.state&&(this.state="running",e(this,"beforeSetup"),this.setup&&this.setup(),e(this,"afterSetup")),"running"===this.state&&(t=this.options.transition(t)*this.fromToDelta+this.options.from,this.position=t,e(this,"beforeUpdate"),this.update&&this.update(t),e(this,"afterUpdate"))}}(),this.event("beforeStart"),this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)},loop:function(e){if(e>=this.startOn){if(e>=this.finishOn)return this.render(1),this.cancel(),this.event("beforeFinish"),this.finish&&this.finish(),this.event("afterFinish"),void 0;var t=(e-this.startOn)/this.totalTime,i=(t*this.totalFrames).round();i>this.currentFrame&&(this.render(t),this.currentFrame=i)}},cancel:function(){this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this),this.state="finished"},event:function(e){this.options[e+"Internal"]&&this.options[e+"Internal"](this),this.options[e]&&this.options[e](this)},inspect:function(){var e=$H();for(property in this)Object.isFunction(this[property])||e.set(property,this[property]);return"#<Effect:"+e.inspect()+",options:"+$H(this.options).inspect()+">"}}),Effect.Parallel=Class.create(Effect.Base,{initialize:function(e){this.effects=e||[],this.start(arguments[1])},update:function(e){this.effects.invoke("render",e)},finish:function(e){this.effects.each(function(t){t.render(1),t.cancel(),t.event("beforeFinish"),t.finish&&t.finish(e),t.event("afterFinish")})}}),Effect.Tween=Class.create(Effect.Base,{initialize:function(e,t,i){e=Object.isString(e)?$(e):e;var n=$A(arguments),s=n.last(),a=5==n.length?n[3]:null;this.method=Object.isFunction(s)?s.bind(e):Object.isFunction(e[s])?e[s].bind(e):function(t){e[s]=t},this.start(Object.extend({from:t,to:i},a||{}))},update:function(e){this.method(e)}}),Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction}),Effect.Opacity=Class.create(Effect.Base,{initialize:function(e){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});var t=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(t)},update:function(e){this.element.setOpacity(e)}}),Effect.Move=Class.create(Effect.Base,{initialize:function(e){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;var t=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(t)},setup:function(){this.element.makePositioned(),this.originalLeft=parseFloat(this.element.getStyle("left")||"0"),this.originalTop=parseFloat(this.element.getStyle("top")||"0"),"absolute"==this.options.mode&&(this.options.x=this.options.x-this.originalLeft,this.options.y=this.options.y-this.originalTop)},update:function(e){this.element.setStyle({left:(this.options.x*e+this.originalLeft).round()+"px",top:(this.options.y*e+this.originalTop).round()+"px"})}}),Effect.MoveBy=function(e,t,i){return new Effect.Move(e,Object.extend({x:i,y:t},arguments[3]||{}))},Effect.Scale=Class.create(Effect.Base,{initialize:function(e,t){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;var i=Object.extend({scaleX:!0,scaleY:!0,scaleContent:!0,scaleFromCenter:!1,scaleMode:"box",scaleFrom:100,scaleTo:t},arguments[2]||{});this.start(i)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||!1,this.elementPositioning=this.element.getStyle("position"),this.originalStyle={},["top","left","width","height","fontSize"].each(function(e){this.originalStyle[e]=this.element.style[e]}.bind(this)),this.originalTop=this.element.offsetTop,this.originalLeft=this.element.offsetLeft;var e=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(t){e.indexOf(t)>0&&(this.fontSize=parseFloat(e),this.fontSizeType=t)}.bind(this)),this.factor=(this.options.scaleTo-this.options.scaleFrom)/100,this.dims=null,"box"==this.options.scaleMode&&(this.dims=[this.element.offsetHeight,this.element.offsetWidth]),/^content/.test(this.options.scaleMode)&&(this.dims=[this.element.scrollHeight,this.element.scrollWidth]),this.dims||(this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth])},update:function(e){var t=this.options.scaleFrom/100+this.factor*e;this.options.scaleContent&&this.fontSize&&this.element.setStyle({fontSize:this.fontSize*t+this.fontSizeType}),this.setDimensions(this.dims[0]*t,this.dims[1]*t)},finish:function(){this.restoreAfterFinish&&this.element.setStyle(this.originalStyle)},setDimensions:function(e,t){var i={};if(this.options.scaleX&&(i.width=t.round()+"px"),this.options.scaleY&&(i.height=e.round()+"px"),this.options.scaleFromCenter){var n=(e-this.dims[0])/2,s=(t-this.dims[1])/2;"absolute"==this.elementPositioning?(this.options.scaleY&&(i.top=this.originalTop-n+"px"),this.options.scaleX&&(i.left=this.originalLeft-s+"px")):(this.options.scaleY&&(i.top=-n+"px"),this.options.scaleX&&(i.left=-s+"px"))}this.element.setStyle(i)}}),Effect.Highlight=Class.create(Effect.Base,{initialize:function(e){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;var t=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(t)},setup:function(){return"none"==this.element.getStyle("display")?(this.cancel(),void 0):(this.oldStyle={},this.options.keepBackgroundImage||(this.oldStyle.backgroundImage=this.element.getStyle("background-image"),this.element.setStyle({backgroundImage:"none"})),this.options.endcolor||(this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")),this.options.restorecolor||(this.options.restorecolor=this.element.getStyle("background-color")),this._base=$R(0,2).map(function(e){return parseInt(this.options.startcolor.slice(2*e+1,2*e+3),16)}.bind(this)),this._delta=$R(0,2).map(function(e){return parseInt(this.options.endcolor.slice(2*e+1,2*e+3),16)-this._base[e]}.bind(this)),void 0)},update:function(e){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(t,i,n){return t+(this._base[n]+this._delta[n]*e).round().toColorPart()}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}}),Effect.ScrollTo=function(e){var t=arguments[1]||{},i=document.viewport.getScrollOffsets(),n=$(e).cumulativeOffset();return t.offset&&(n[1]+=t.offset),new Effect.Tween(null,i.top,n[1],t,function(e){scrollTo(i.left,e.round())})},Effect.Fade=function(e){e=$(e);var t=e.getInlineOpacity(),i=Object.extend({from:e.getOpacity()||1,to:0,afterFinishInternal:function(e){0==e.options.to&&e.element.hide().setStyle({opacity:t})}},arguments[1]||{});return new Effect.Opacity(e,i)},Effect.Appear=function(e){e=$(e);var t=Object.extend({from:"none"==e.getStyle("display")?0:e.getOpacity()||0,to:1,afterFinishInternal:function(e){e.element.forceRerendering()},beforeSetup:function(e){e.element.setOpacity(e.options.from).show()}},arguments[1]||{});return new Effect.Opacity(e,t)},Effect.Puff=function(e){e=$(e);var t={opacity:e.getInlineOpacity(),position:e.getStyle("position"),top:e.style.top,left:e.style.left,width:e.style.width,height:e.style.height};return new Effect.Parallel([new Effect.Scale(e,200,{sync:!0,scaleFromCenter:!0,scaleContent:!0,restoreAfterFinish:!0}),new Effect.Opacity(e,{sync:!0,to:0})],Object.extend({duration:1,beforeSetupInternal:function(e){Position.absolutize(e.effects[0].element)},afterFinishInternal:function(e){e.effects[0].element.hide().setStyle(t)}},arguments[1]||{}))},Effect.BlindUp=function(e){return e=$(e),e.makeClipping(),new Effect.Scale(e,0,Object.extend({scaleContent:!1,scaleX:!1,restoreAfterFinish:!0,afterFinishInternal:function(e){e.element.hide().undoClipping()}},arguments[1]||{}))},Effect.BlindDown=function(e){e=$(e);var t=e.getDimensions();return new Effect.Scale(e,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:0,scaleMode:{originalHeight:t.height,originalWidth:t.width},restoreAfterFinish:!0,afterSetup:function(e){e.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(e){e.element.undoClipping()}},arguments[1]||{}))},Effect.SwitchOff=function(e){e=$(e);var t=e.getInlineOpacity();return new Effect.Appear(e,Object.extend({duration:.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(e){new Effect.Scale(e.element,1,{duration:.3,scaleFromCenter:!0,scaleX:!1,scaleContent:!1,restoreAfterFinish:!0,beforeSetup:function(e){e.element.makePositioned().makeClipping()},afterFinishInternal:function(e){e.element.hide().undoClipping().undoPositioned().setStyle({opacity:t})}})}},arguments[1]||{}))},Effect.DropOut=function(e){e=$(e);var t={top:e.getStyle("top"),left:e.getStyle("left"),opacity:e.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(e,{x:0,y:100,sync:!0}),new Effect.Opacity(e,{sync:!0,to:0})],Object.extend({duration:.5,beforeSetup:function(e){e.effects[0].element.makePositioned()},afterFinishInternal:function(e){e.effects[0].element.hide().undoPositioned().setStyle(t)}},arguments[1]||{}))},Effect.Shake=function(e){e=$(e);var t=Object.extend({distance:20,duration:.5},arguments[1]||{}),i=parseFloat(t.distance),n=parseFloat(t.duration)/10,s={top:e.getStyle("top"),left:e.getStyle("left")};return new Effect.Move(e,{x:i,y:0,duration:n,afterFinishInternal:function(e){new Effect.Move(e.element,{x:2*-i,y:0,duration:2*n,afterFinishInternal:function(e){new Effect.Move(e.element,{x:2*i,y:0,duration:2*n,afterFinishInternal:function(e){new Effect.Move(e.element,{x:2*-i,y:0,duration:2*n,afterFinishInternal:function(e){new Effect.Move(e.element,{x:2*i,y:0,duration:2*n,afterFinishInternal:function(e){new Effect.Move(e.element,{x:-i,y:0,duration:n,afterFinishInternal:function(e){e.element.undoPositioned().setStyle(s)}})}})}})}})}})}})},Effect.SlideDown=function(e){e=$(e).cleanWhitespace();var t=e.down().getStyle("bottom"),i=e.getDimensions();return new Effect.Scale(e,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:i.height,originalWidth:i.width},restoreAfterFinish:!0,afterSetup:function(e){e.element.makePositioned(),e.element.down().makePositioned(),window.opera&&e.element.setStyle({top:""}),e.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(e){e.element.down().setStyle({bottom:e.dims[0]-e.element.clientHeight+"px"})
},afterFinishInternal:function(e){e.element.undoClipping().undoPositioned(),e.element.down().undoPositioned().setStyle({bottom:t})}},arguments[1]||{}))},Effect.SlideUp=function(e){e=$(e).cleanWhitespace();var t=e.down().getStyle("bottom"),i=e.getDimensions();return new Effect.Scale(e,window.opera?0:1,Object.extend({scaleContent:!1,scaleX:!1,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:i.height,originalWidth:i.width},restoreAfterFinish:!0,afterSetup:function(e){e.element.makePositioned(),e.element.down().makePositioned(),window.opera&&e.element.setStyle({top:""}),e.element.makeClipping().show()},afterUpdateInternal:function(e){e.element.down().setStyle({bottom:e.dims[0]-e.element.clientHeight+"px"})},afterFinishInternal:function(e){e.element.hide().undoClipping().undoPositioned(),e.element.down().undoPositioned().setStyle({bottom:t})}},arguments[1]||{}))},Effect.Squish=function(e){return new Effect.Scale(e,window.opera?1:0,{restoreAfterFinish:!0,beforeSetup:function(e){e.element.makeClipping()},afterFinishInternal:function(e){e.element.hide().undoClipping()}})},Effect.Grow=function(e){e=$(e);var t,i,n,s,a=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{}),o={top:e.style.top,left:e.style.left,height:e.style.height,width:e.style.width,opacity:e.getInlineOpacity()},l=e.getDimensions();switch(a.direction){case"top-left":t=i=n=s=0;break;case"top-right":t=l.width,i=s=0,n=-l.width;break;case"bottom-left":t=n=0,i=l.height,s=-l.height;break;case"bottom-right":t=l.width,i=l.height,n=-l.width,s=-l.height;break;case"center":t=l.width/2,i=l.height/2,n=-l.width/2,s=-l.height/2}return new Effect.Move(e,{x:t,y:i,duration:.01,beforeSetup:function(e){e.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(e){new Effect.Parallel([new Effect.Opacity(e.element,{sync:!0,to:1,from:0,transition:a.opacityTransition}),new Effect.Move(e.element,{x:n,y:s,sync:!0,transition:a.moveTransition}),new Effect.Scale(e.element,100,{scaleMode:{originalHeight:l.height,originalWidth:l.width},sync:!0,scaleFrom:window.opera?1:0,transition:a.scaleTransition,restoreAfterFinish:!0})],Object.extend({beforeSetup:function(e){e.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(e){e.effects[0].element.undoClipping().undoPositioned().setStyle(o)}},a))}})},Effect.Shrink=function(e){e=$(e);var t,i,n=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{}),s={top:e.style.top,left:e.style.left,height:e.style.height,width:e.style.width,opacity:e.getInlineOpacity()},a=e.getDimensions();switch(n.direction){case"top-left":t=i=0;break;case"top-right":t=a.width,i=0;break;case"bottom-left":t=0,i=a.height;break;case"bottom-right":t=a.width,i=a.height;break;case"center":t=a.width/2,i=a.height/2}return new Effect.Parallel([new Effect.Opacity(e,{sync:!0,to:0,from:1,transition:n.opacityTransition}),new Effect.Scale(e,window.opera?1:0,{sync:!0,transition:n.scaleTransition,restoreAfterFinish:!0}),new Effect.Move(e,{x:t,y:i,sync:!0,transition:n.moveTransition})],Object.extend({beforeStartInternal:function(e){e.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(e){e.effects[0].element.hide().undoClipping().undoPositioned().setStyle(s)}},n))},Effect.Pulsate=function(e){e=$(e);var t=arguments[1]||{},i=e.getInlineOpacity(),n=t.transition||Effect.Transitions.linear,s=function(e){return 1-n(-Math.cos(2*e*(t.pulses||5)*Math.PI)/2+.5)};return new Effect.Opacity(e,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(e){e.element.setStyle({opacity:i})}},t),{transition:s}))},Effect.Fold=function(e){e=$(e);var t={top:e.style.top,left:e.style.left,width:e.style.width,height:e.style.height};return e.makeClipping(),new Effect.Scale(e,5,Object.extend({scaleContent:!1,scaleX:!1,afterFinishInternal:function(){new Effect.Scale(e,1,{scaleContent:!1,scaleY:!1,afterFinishInternal:function(e){e.element.hide().undoClipping().setStyle(t)}})}},arguments[1]||{}))},Effect.Morph=Class.create(Effect.Base,{initialize:function(e){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;var t=Object.extend({style:{}},arguments[1]||{});if(Object.isString(t.style))if(t.style.include(":"))this.style=t.style.parseStyle();else{this.element.addClassName(t.style),this.style=$H(this.element.getStyles()),this.element.removeClassName(t.style);var i=this.element.getStyles();this.style=this.style.reject(function(e){return e.value==i[e.key]}),t.afterFinishInternal=function(e){e.element.addClassName(e.options.style),e.transforms.each(function(t){e.element.style[t.style]=""})}}else this.style=$H(t.style);this.start(t)},setup:function(){function e(e){return(!e||["rgba(0, 0, 0, 0)","transparent"].include(e))&&(e="#ffffff"),e=e.parseColor(),$R(0,2).map(function(t){return parseInt(e.slice(2*t+1,2*t+3),16)})}this.transforms=this.style.map(function(t){var i=t[0],n=t[1],s=null;if("#zzzzzz"!=n.parseColor("#zzzzzz"))n=n.parseColor(),s="color";else if("opacity"==i)n=parseFloat(n),Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});else if(Element.CSS_LENGTH.test(n)){var a=n.match(/^([\+\-]?[0-9\.]+)(.*)$/);n=parseFloat(a[1]),s=3==a.length?a[2]:null}var o=this.element.getStyle(i);return{style:i.camelize(),originalValue:"color"==s?e(o):parseFloat(o||0),targetValue:"color"==s?e(n):n,unit:s}}.bind(this)).reject(function(e){return e.originalValue==e.targetValue||"color"!=e.unit&&(isNaN(e.originalValue)||isNaN(e.targetValue))})},update:function(e){for(var t,i={},n=this.transforms.length;n--;)i[(t=this.transforms[n]).style]="color"==t.unit?"#"+Math.round(t.originalValue[0]+(t.targetValue[0]-t.originalValue[0])*e).toColorPart()+Math.round(t.originalValue[1]+(t.targetValue[1]-t.originalValue[1])*e).toColorPart()+Math.round(t.originalValue[2]+(t.targetValue[2]-t.originalValue[2])*e).toColorPart():(t.originalValue+(t.targetValue-t.originalValue)*e).toFixed(3)+(null===t.unit?"":t.unit);this.element.setStyle(i,!0)}}),Effect.Transform=Class.create({initialize:function(e){this.tracks=[],this.options=arguments[1]||{},this.addTracks(e)},addTracks:function(e){return e.each(function(e){e=$H(e);var t=e.values().first();this.tracks.push($H({ids:e.keys().first(),effect:Effect.Morph,options:{style:t}}))}.bind(this)),this},play:function(){return new Effect.Parallel(this.tracks.map(function(e){var t=e.get("ids"),i=e.get("effect"),n=e.get("options"),s=[$(t)||$$(t)].flatten();return s.map(function(e){return new i(e,Object.extend({sync:!0},n))})}).flatten(),this.options)}}),Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex"),Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/,String.__parseStyleElement=document.createElement("div"),String.prototype.parseStyle=function(){var e,t=$H();return Prototype.Browser.WebKit?e=new Element("div",{style:this}).style:(String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>',e=String.__parseStyleElement.childNodes[0].style),Element.CSS_PROPERTIES.each(function(i){e[i]&&t.set(i,e[i])}),Prototype.Browser.IE&&this.include("opacity")&&t.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]),t},Element.getStyles=document.defaultView&&document.defaultView.getComputedStyle?function(e){var t=document.defaultView.getComputedStyle($(e),null);return Element.CSS_PROPERTIES.inject({},function(e,i){return e[i]=t[i],e})}:function(e){e=$(e);var t,i=e.currentStyle;return t=Element.CSS_PROPERTIES.inject({},function(e,t){return e[t]=i[t],e}),t.opacity||(t.opacity=e.getOpacity()),t},Effect.Methods={morph:function(e,t){return e=$(e),new Effect.Morph(e,Object.extend({style:t},arguments[2]||{})),e},visualEffect:function(e,t,i){e=$(e);var n=t.dasherize().camelize(),s=n.charAt(0).toUpperCase()+n.substring(1);return new Effect[s](e,i),e},highlight:function(e,t){return e=$(e),new Effect.Highlight(e,t),e}},$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(e){Effect.Methods[e]=function(t,i){return t=$(t),Effect[e.charAt(0).toUpperCase()+e.substring(1)](t,i),t}}),$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(e){Effect.Methods[e]=Element[e]}),Element.addMethods(Effect.Methods),Object.isUndefined(Effect))throw"dragdrop.js requires including script.aculo.us' effects.js library";var Droppables={drops:[],remove:function(e){this.drops=this.drops.reject(function(t){return t.element==$(e)})},add:function(e){e=$(e);var t=Object.extend({greedy:!0,hoverclass:null,tree:!1},arguments[1]||{});if(t.containment){t._containers=[];var i=t.containment;Object.isArray(i)?i.each(function(e){t._containers.push($(e))}):t._containers.push($(i))}t.accept&&(t.accept=[t.accept].flatten()),Element.makePositioned(e),t.element=e,this.drops.push(t)},findDeepestChild:function(e){for(deepest=e[0],i=1;e.length>i;++i)Element.isParent(e[i].element,deepest.element)&&(deepest=e[i]);return deepest},isContained:function(e,t){var i;return i=t.tree?e.treeNode:e.parentNode,t._containers.detect(function(e){return i==e})},isAffected:function(e,t,i){return i.element!=t&&(!i._containers||this.isContained(t,i))&&(!i.accept||Element.classNames(t).detect(function(e){return i.accept.include(e)}))&&Position.within(i.element,e[0],e[1])},deactivate:function(e){e.hoverclass&&Element.removeClassName(e.element,e.hoverclass),this.last_active=null},activate:function(e){e.hoverclass&&Element.addClassName(e.element,e.hoverclass),this.last_active=e},show:function(e,t){if(this.drops.length){var i,n=[];this.drops.each(function(i){Droppables.isAffected(e,t,i)&&n.push(i)}),n.length>0&&(i=Droppables.findDeepestChild(n)),this.last_active&&this.last_active!=i&&this.deactivate(this.last_active),i&&(Position.within(i.element,e[0],e[1]),i.onHover&&i.onHover(t,i.element,Position.overlap(i.overlap,i.element)),i!=this.last_active&&Droppables.activate(i))}},fire:function(e,t){return this.last_active?(Position.prepare(),this.isAffected([Event.pointerX(e),Event.pointerY(e)],t,this.last_active)&&this.last_active.onDrop?(this.last_active.onDrop(t,this.last_active.element,e),!0):void 0):void 0},reset:function(){this.last_active&&this.deactivate(this.last_active)}},Draggables={drags:[],observers:[],register:function(e){0==this.drags.length&&(this.eventMouseUp=this.endDrag.bindAsEventListener(this),this.eventMouseMove=this.updateDrag.bindAsEventListener(this),this.eventKeypress=this.keyPress.bindAsEventListener(this),Event.observe(document,"mouseup",this.eventMouseUp),Event.observe(document,"mousemove",this.eventMouseMove),Event.observe(document,"keypress",this.eventKeypress)),this.drags.push(e)},unregister:function(e){this.drags=this.drags.reject(function(t){return t==e}),0==this.drags.length&&(Event.stopObserving(document,"mouseup",this.eventMouseUp),Event.stopObserving(document,"mousemove",this.eventMouseMove),Event.stopObserving(document,"keypress",this.eventKeypress))},activate:function(e){e.options.delay?this._timeout=setTimeout(function(){Draggables._timeout=null,window.focus(),Draggables.activeDraggable=e}.bind(this),e.options.delay):(window.focus(),this.activeDraggable=e)},deactivate:function(){this.activeDraggable=null},updateDrag:function(e){if(this.activeDraggable){var t=[Event.pointerX(e),Event.pointerY(e)];this._lastPointer&&this._lastPointer.inspect()==t.inspect()||(this._lastPointer=t,this.activeDraggable.updateDrag(e,t))}},endDrag:function(e){this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this.activeDraggable&&(this._lastPointer=null,this.activeDraggable.endDrag(e),this.activeDraggable=null)},keyPress:function(e){this.activeDraggable&&this.activeDraggable.keyPress(e)},addObserver:function(e){this.observers.push(e),this._cacheObserverCallbacks()},removeObserver:function(e){this.observers=this.observers.reject(function(t){return t.element==e}),this._cacheObserverCallbacks()},notify:function(e,t,i){this[e+"Count"]>0&&this.observers.each(function(n){n[e]&&n[e](e,t,i)}),t.options[e]&&t.options[e](t,i)},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(e){Draggables[e+"Count"]=Draggables.observers.select(function(t){return t[e]}).length})}},Draggable=Class.create({initialize:function(e){var t={handle:!1,reverteffect:function(e,t,i){var n=.02*Math.sqrt(Math.abs(2^t)+Math.abs(2^i));new Effect.Move(e,{x:-i,y:-t,duration:n,queue:{scope:"_draggable",position:"end"}})},endeffect:function(e){var t=Object.isNumber(e._opacity)?e._opacity:1;new Effect.Opacity(e,{duration:.2,from:.7,to:t,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[e]=!1}})},zindex:1e3,revert:!1,quiet:!1,scroll:!1,scrollSensitivity:20,scrollSpeed:15,snap:!1,delay:0};(!arguments[1]||Object.isUndefined(arguments[1].endeffect))&&Object.extend(t,{starteffect:function(e){e._opacity=Element.getOpacity(e),Draggable._dragging[e]=!0,new Effect.Opacity(e,{duration:.2,from:e._opacity,to:.7})}});var i=Object.extend(t,arguments[1]||{});this.element=$(e),i.handle&&Object.isString(i.handle)&&(this.handle=this.element.down("."+i.handle,0)),this.handle||(this.handle=$(i.handle)),this.handle||(this.handle=this.element),!i.scroll||i.scroll.scrollTo||i.scroll.outerHTML||(i.scroll=$(i.scroll),this._isScrollChild=Element.childOf(this.element,i.scroll)),Element.makePositioned(this.element),this.options=i,this.dragging=!1,this.eventMouseDown=this.initDrag.bindAsEventListener(this),Event.observe(this.handle,"mousedown",this.eventMouseDown),Draggables.register(this)},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown),Draggables.unregister(this)},currentDelta:function(){return[parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")]},initDrag:function(e){if((Object.isUndefined(Draggable._dragging[this.element])||!Draggable._dragging[this.element])&&Event.isLeftClick(e)){var t=Event.element(e);if((tag_name=t.tagName.toUpperCase())&&("INPUT"==tag_name||"SELECT"==tag_name||"OPTION"==tag_name||"BUTTON"==tag_name||"TEXTAREA"==tag_name))return;var i=[Event.pointerX(e),Event.pointerY(e)],n=this.element.cumulativeOffset();this.offset=[0,1].map(function(e){return i[e]-n[e]}),Draggables.activate(this),Event.stop(e)}},startDrag:function(e){if(this.dragging=!0,this.delta||(this.delta=this.currentDelta()),this.options.zindex&&(this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0),this.element.style.zIndex=this.options.zindex),this.options.ghosting&&(this._clone=this.element.cloneNode(!0),this._originallyAbsolute="absolute"==this.element.getStyle("position"),this._originallyAbsolute||Position.absolutize(this.element),this.element.parentNode.insertBefore(this._clone,this.element)),this.options.scroll)if(this.options.scroll==window){var t=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=t.left,this.originalScrollTop=t.top}else this.originalScrollLeft=this.options.scroll.scrollLeft,this.originalScrollTop=this.options.scroll.scrollTop;Draggables.notify("onStart",this,e),this.options.starteffect&&this.options.starteffect(this.element)},updateDrag:function(event,pointer){if(this.dragging||this.startDrag(event),this.options.quiet||(Position.prepare(),Droppables.show(pointer,this.element)),Draggables.notify("onDrag",this,event),this.draw(pointer),this.options.change&&this.options.change(this),this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll))p=[left,top,left+width,top+height];else p=Position.page(this.options.scroll).toArray(),p[0]+=this.options.scroll.scrollLeft+Position.deltaX,p[1]+=this.options.scroll.scrollTop+Position.deltaY,p.push(p[0]+this.options.scroll.offsetWidth),p.push(p[1]+this.options.scroll.offsetHeight);var speed=[0,0];pointer[0]<p[0]+this.options.scrollSensitivity&&(speed[0]=pointer[0]-(p[0]+this.options.scrollSensitivity)),pointer[1]<p[1]+this.options.scrollSensitivity&&(speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity)),pointer[0]>p[2]-this.options.scrollSensitivity&&(speed[0]=pointer[0]-(p[2]-this.options.scrollSensitivity)),pointer[1]>p[3]-this.options.scrollSensitivity&&(speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity)),this.startScrolling(speed)}Prototype.Browser.WebKit&&window.scrollBy(0,0),Event.stop(event)},finishDrag:function(e,t){if(this.dragging=!1,this.options.quiet){Position.prepare();var i=[Event.pointerX(e),Event.pointerY(e)];Droppables.show(i,this.element)}this.options.ghosting&&(this._originallyAbsolute||Position.relativize(this.element),delete this._originallyAbsolute,Element.remove(this._clone),this._clone=null);var n=!1;t&&(n=Droppables.fire(e,this.element),n||(n=!1)),n&&this.options.onDropped&&this.options.onDropped(this.element),Draggables.notify("onEnd",this,e);var s=this.options.revert;s&&Object.isFunction(s)&&(s=s(this.element));var a=this.currentDelta();s&&this.options.reverteffect?(0==n||"failure"!=s)&&this.options.reverteffect(this.element,a[1]-this.delta[1],a[0]-this.delta[0]):this.delta=a,this.options.zindex&&(this.element.style.zIndex=this.originalZ),this.options.endeffect&&this.options.endeffect(this.element),Draggables.deactivate(this),Droppables.reset()},keyPress:function(e){e.keyCode==Event.KEY_ESC&&(this.finishDrag(e,!1),Event.stop(e))},endDrag:function(e){this.dragging&&(this.stopScrolling(),this.finishDrag(e,!0),Event.stop(e))},draw:function(e){var t=this.element.cumulativeOffset();if(this.options.ghosting){var i=Position.realOffset(this.element);t[0]+=i[0]-Position.deltaX,t[1]+=i[1]-Position.deltaY}var n=this.currentDelta();t[0]-=n[0],t[1]-=n[1],this.options.scroll&&this.options.scroll!=window&&this._isScrollChild&&(t[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft,t[1]-=this.options.scroll.scrollTop-this.originalScrollTop);var s=[0,1].map(function(i){return e[i]-t[i]-this.offset[i]}.bind(this));this.options.snap&&(s=Object.isFunction(this.options.snap)?this.options.snap(s[0],s[1],this):Object.isArray(this.options.snap)?s.map(function(e,t){return(e/this.options.snap[t]).round()*this.options.snap[t]}.bind(this)):s.map(function(e){return(e/this.options.snap).round()*this.options.snap}.bind(this)));var a=this.element.style;this.options.constraint&&"horizontal"!=this.options.constraint||(a.left=s[0]+"px"),this.options.constraint&&"vertical"!=this.options.constraint||(a.top=s[1]+"px"),"hidden"==a.visibility&&(a.visibility="")},stopScrolling:function(){this.scrollInterval&&(clearInterval(this.scrollInterval),this.scrollInterval=null,Draggables._lastScrollPointer=null)},startScrolling:function(e){(e[0]||e[1])&&(this.scrollSpeed=[e[0]*this.options.scrollSpeed,e[1]*this.options.scrollSpeed],this.lastScrolled=new Date,this.scrollInterval=setInterval(this.scroll.bind(this),10))},scroll:function(){var current=new Date,delta=current-this.lastScrolled;if(this.lastScrolled=current,this.options.scroll==window){with(this._getWindowScroll(this.options.scroll))if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1e3;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1])}}else this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1e3,this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1e3;Position.prepare(),Droppables.show(Draggables._lastPointer,this.element),Draggables.notify("onDrag",this),this._isScrollChild&&(Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer),Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1e3,Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1e3,0>Draggables._lastScrollPointer[0]&&(Draggables._lastScrollPointer[0]=0),0>Draggables._lastScrollPointer[1]&&(Draggables._lastScrollPointer[1]=0),this.draw(Draggables._lastScrollPointer)),this.options.change&&this.options.change(this)},_getWindowScroll:function(w){var T,L,W,H;with(w.document)w.document.documentElement&&documentElement.scrollTop?(T=documentElement.scrollTop,L=documentElement.scrollLeft):w.document.body&&(T=body.scrollTop,L=body.scrollLeft),w.innerWidth?(W=w.innerWidth,H=w.innerHeight):w.document.documentElement&&documentElement.clientWidth?(W=documentElement.clientWidth,H=documentElement.clientHeight):(W=body.offsetWidth,H=body.offsetHeight);return{top:T,left:L,width:W,height:H}}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(e,t){this.element=$(e),this.observer=t,this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(){Sortable.unmark(),this.lastValue!=Sortable.serialize(this.element)&&this.observer(this.element)}}),Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(e){for(;"BODY"!=e.tagName.toUpperCase();){if(e.id&&Sortable.sortables[e.id])return e;e=e.parentNode}},options:function(e){return(e=Sortable._findRootElement($(e)))?Sortable.sortables[e.id]:void 0},destroy:function(e){e=$(e);var t=Sortable.sortables[e.id];t&&(Draggables.removeObserver(t.element),t.droppables.each(function(e){Droppables.remove(e)}),t.draggables.invoke("destroy"),delete Sortable.sortables[t.element.id])},create:function(e){e=$(e);var t=Object.extend({element:e,tag:"li",dropOnEmpty:!1,tree:!1,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:e,handle:!1,only:!1,delay:0,hoverclass:null,ghosting:!1,quiet:!1,scroll:!1,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:!1,handles:!1,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(e);var i={revert:!0,quiet:t.quiet,scroll:t.scroll,scrollSpeed:t.scrollSpeed,scrollSensitivity:t.scrollSensitivity,delay:t.delay,ghosting:t.ghosting,constraint:t.constraint,handle:t.handle};t.starteffect&&(i.starteffect=t.starteffect),t.reverteffect?i.reverteffect=t.reverteffect:t.ghosting&&(i.reverteffect=function(e){e.style.top=0,e.style.left=0}),t.endeffect&&(i.endeffect=t.endeffect),t.zindex&&(i.zindex=t.zindex);var n={overlap:t.overlap,containment:t.containment,tree:t.tree,hoverclass:t.hoverclass,onHover:Sortable.onHover},s={onHover:Sortable.onEmptyHover,overlap:t.overlap,containment:t.containment,hoverclass:t.hoverclass};Element.cleanWhitespace(e),t.draggables=[],t.droppables=[],(t.dropOnEmpty||t.tree)&&(Droppables.add(e,s),t.droppables.push(e)),(t.elements||this.findElements(e,t)||[]).each(function(s,a){var o=t.handles?$(t.handles[a]):t.handle?$(s).select("."+t.handle)[0]:s;t.draggables.push(new Draggable(s,Object.extend(i,{handle:o}))),Droppables.add(s,n),t.tree&&(s.treeNode=e),t.droppables.push(s)}),t.tree&&(Sortable.findTreeElements(e,t)||[]).each(function(i){Droppables.add(i,s),i.treeNode=e,t.droppables.push(i)}),this.sortables[e.identify()]=t,Draggables.addObserver(new SortableObserver(e,t.onUpdate))},findElements:function(e,t){return Element.findChildren(e,t.only,t.tree?!0:!1,t.tag)},findTreeElements:function(e,t){return Element.findChildren(e,t.only,t.tree?!0:!1,t.treeTag)},onHover:function(e,t,i){if(!(Element.isParent(t,e)||i>.33&&.66>i&&Sortable.options(t).tree))if(i>.5){if(Sortable.mark(t,"before"),t.previousSibling!=e){var n=e.parentNode;e.style.visibility="hidden",t.parentNode.insertBefore(e,t),t.parentNode!=n&&Sortable.options(n).onChange(e),Sortable.options(t.parentNode).onChange(e)}}else{Sortable.mark(t,"after");var s=t.nextSibling||null;if(s!=e){var n=e.parentNode;e.style.visibility="hidden",t.parentNode.insertBefore(e,s),t.parentNode!=n&&Sortable.options(n).onChange(e),Sortable.options(t.parentNode).onChange(e)}}},onEmptyHover:function(e,t,i){var n=e.parentNode,s=Sortable.options(t);if(!Element.isParent(t,e)){var a,o=Sortable.findElements(t,{tag:s.tag,only:s.only}),l=null;if(o){var r=Element.offsetSize(t,s.overlap)*(1-i);for(a=0;o.length>a;a+=1){if(!(r-Element.offsetSize(o[a],s.overlap)>=0)){if(r-Element.offsetSize(o[a],s.overlap)/2>=0){l=o.length>a+1?o[a+1]:null;break}l=o[a];break}r-=Element.offsetSize(o[a],s.overlap)}}t.insertBefore(e,l),Sortable.options(n).onChange(e),s.onChange(e)}},unmark:function(){Sortable._marker&&Sortable._marker.hide()},mark:function(e,t){var i=Sortable.options(e.parentNode);if(!i||i.ghosting){Sortable._marker||(Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"}),document.getElementsByTagName("body").item(0).appendChild(Sortable._marker));var n=e.cumulativeOffset();Sortable._marker.setStyle({left:n[0]+"px",top:n[1]+"px"}),"after"==t&&("horizontal"==i.overlap?Sortable._marker.setStyle({left:n[0]+e.clientWidth+"px"}):Sortable._marker.setStyle({top:n[1]+e.clientHeight+"px"})),Sortable._marker.show()}},_tree:function(e,t,i){for(var n=Sortable.findElements(e,t)||[],s=0;n.length>s;++s){var a=n[s].id.match(t.format);if(a){var o={id:encodeURIComponent(a?a[1]:null),element:e,parent:i,children:[],position:i.children.length,container:$(n[s]).down(t.treeTag)};o.container&&this._tree(o.container,t,o),i.children.push(o)}}return i},tree:function(e){e=$(e);var t=this.options(e),i=Object.extend({tag:t.tag,treeTag:t.treeTag,only:t.only,name:e.id,format:t.format},arguments[1]||{}),n={id:null,parent:null,children:[],container:e,position:0};return Sortable._tree(e,i,n)},_constructIndex:function(e){var t="";do e.id&&(t="["+e.position+"]"+t);while(null!=(e=e.parent));return t},sequence:function(e){e=$(e);var t=Object.extend(this.options(e),arguments[1]||{});return $(this.findElements(e,t)||[]).map(function(e){return e.id.match(t.format)?e.id.match(t.format)[1]:""})},setSequence:function(e,t){e=$(e);var i=Object.extend(this.options(e),arguments[2]||{}),n={};this.findElements(e,i).each(function(e){e.id.match(i.format)&&(n[e.id.match(i.format)[1]]=[e,e.parentNode]),e.parentNode.removeChild(e)}),t.each(function(e){var t=n[e];t&&(t[1].appendChild(t[0]),delete n[e])})},serialize:function(e){e=$(e);var t=Object.extend(Sortable.options(e),arguments[1]||{}),i=encodeURIComponent(arguments[1]&&arguments[1].name?arguments[1].name:e.id);return t.tree?Sortable.tree(e,arguments[1]).children.map(function(e){return[i+Sortable._constructIndex(e)+"[id]="+encodeURIComponent(e.id)].concat(e.children.map(arguments.callee))}).flatten().join("&"):Sortable.sequence(e,arguments[1]).map(function(e){return i+"[]="+encodeURIComponent(e)}).join("&")}};Element.isParent=function(e,t){return e.parentNode&&e!=t?e.parentNode==t?!0:Element.isParent(e.parentNode,t):!1},Element.findChildren=function(e,t,i,n){if(!e.hasChildNodes())return null;n=n.toUpperCase(),t&&(t=[t].flatten());var s=[];return $A(e.childNodes).each(function(e){if(!e.tagName||e.tagName.toUpperCase()!=n||t&&!Element.classNames(e).detect(function(e){return t.include(e)})||s.push(e),i){var a=Element.findChildren(e,t,i,n);a&&s.push(a)}}),s.length>0?s.flatten():[]},Element.offsetSize=function(e,t){return e["offset"+("vertical"==t||"height"==t?"Height":"Width")]};